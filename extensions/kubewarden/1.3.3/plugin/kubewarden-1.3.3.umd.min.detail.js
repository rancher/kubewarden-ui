(("undefined"!==typeof self?self:this)["webpackJsonpkubewarden_1_3_3"]=("undefined"!==typeof self?self:this)["webpackJsonpkubewarden_1_3_3"]||[]).push([[2],{"00ce":function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;return e.$fetchState.pending||e.refreshingCharts?t("Loading",{attrs:{mode:"relative"}}):t("div",[e.showChecklist?t("TraceChecklist",{attrs:{"controller-app":e.controllerApp,"controller-chart":e.controllerChart,"tracing-configuration":e.tracingConfiguration,"jaeger-query-svc":e.jaegerQuerySvc,"open-tel-svc":e.openTelSvc}}):!e.showChecklist&&e.emptyPolicies?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.tracing.noRelatedPolicies")}}):e.showTable?t("SortableTable",{attrs:{rows:e.filteredValidations,headers:e.TRACE_HEADERS,"table-actions":!1,"row-actions":!1,"key-field":"id","default-sort-by":"startTime","sub-expandable":!0,"sub-expand-column":!0,"sub-rows":!0,paging:!0,"rows-per-page":e.rowsPerPage},scopedSlots:e._u([{key:"col:mode",fn:function({row:r}){return[t("td",[t("BadgeState",{staticClass:"text-capitalize",attrs:{label:r.mode,color:e.modeColor(r.mode)}})],1)]}},{key:"col:name",fn:function({row:r}){return[t("td",{staticClass:"text-bold"},[e._v(" "+e._s(r.name)+" ")])]}},{key:"col:namespace",fn:function({row:r}){return[t("td",[e._v(" "+e._s(r.namespace?r.namespace:"-")+" ")])]}},{key:"col:startTime",fn:function({row:r}){return[t("td",[e._v(" "+e._s(e.formatTime(r.startTime))+" ")])]}},{key:"col:duration",fn:function({row:r}){return[t("td",[e._v(" "+e._s(e.duration(r.duration))+" ")])]}},{key:"sub-row",fn:function({row:r,fullColspan:a}){return[t("td",{staticClass:"sub-row",attrs:{colspan:a}},[t("div",{staticClass:"details"},[t("section",{staticClass:"col"},[t("div",{staticClass:"title"},[e._v(" Response Message ")]),t("span",{staticClass:"text-info text-capitalize"},[e._v(" "+e._s(r.responseMessage?r.responseMessage:"-")+" ")])]),t("section",{staticClass:"col"},[t("div",{staticClass:"title"},[e._v(" Response Code ")]),t("span",{staticClass:"text-info"},[e._v(" "+e._s(r.responseCode?r.responseCode:"-")+" ")])]),t("section",{staticClass:"col"},[t("div",{staticClass:"title"},[e._v(" Mutated ")]),t("span",{staticClass:"text-info"},[e._v(" "+e._s(r.mutated)+" ")])])])])]}}])}):t("Banner",{attrs:{color:"warning",label:e.t(e.emptyTracesLabel)}})],1)},i=[],o=r("9ce4"),n=r("330a"),s=r.n(n),l=r("050d"),c=r.n(l),d=r("be6d"),u=r.n(d),p=r("907c"),v=r("4ac6"),h=r("2359"),m=r("a8b9"),b=r("f17a"),f=r("6418"),g=r("15ca"),y=r("0fb1"),k=r("5191"),w=r("90cd");function _(e,t){const r=null===e||void 0===e?void 0:e.links["view"],a=r.lastIndexOf("/");return C(r.slice(0,a),"http",null===e||void 0===e?void 0:e.metadata.name,t)}function C(e,t,r,a,i){const o=(t?encodeURIComponent(t)+":":"")+encodeURIComponent(r)+(a?":"+encodeURIComponent(a):""),n="/"+(i||"").replace(/^\/+/g,""),s=e.replace(/\/+$/g,""),l=`${s}/${o}/proxy${n}`;return l}async function S(e){const{store:t,queryService:r,resource:a,relatedPolicies:i,policy:o,time:n}=e;try{const e=_(r,16686),l=[];if(s()(i)){if(!o)throw new Error("Policy is undefined");l.push(O(t,e,o,n))}else null===i||void 0===i||i.forEach(r=>{const a=O(t,e,r,n);a&&l.push(a)});let c=await Promise.all(l);return c=c.flatMap(e=>null===e||void 0===e?void 0:e.data),A(t,c,a,i,o)}catch(l){console.warn("Error fetching Jaeger traces: "+l)}return null}function T(e){var t,r,a;let i=null;switch(null===e||void 0===e?void 0:e.kind){case"ClusterAdmissionPolicy":i="clusterwide-"+(null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name);break;case"AdmissionPolicy":i=`namespaced-${null===e||void 0===e||null===(r=e.metadata)||void 0===r?void 0:r.namespace}-${null===e||void 0===e||null===(a=e.metadata)||void 0===a?void 0:a.name}`;break;default:break}return i}function O(e,t,r,a){let i=null;const o=T(r),n=a||"2d",s=`lookback=${n}&tags={"policy_id"%3A"${o}"}`;i="api/traces?service=kubewarden-policy-server&operation=validation&"+s;const l=""+(t+i);return e.dispatch("cluster/request",{url:l})}function A(e,t,r,a,i){const o=e.getters["currentCluster"],n=[];function l(r){const a=T(r);return t.reduce((t,i)=>{var n;let l={};const c=i.spans.find(e=>"validation"===e.operationName),d=null===c||void 0===c||null===(n=c.tags)||void 0===n?void 0:n.find(e=>"policy_id"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e?void 0:e.value)===a);if(d){const e=E(c.tags);l={id:i.traceID,allowed:e.allowed,mode:r.spec.mode,name:e.name,operation:e.operation,kind:e.kind,namespace:e.namespace||null,startTime:c.startTime,duration:c.duration,responseMessage:e.response_message,responseCode:e.response_code,mutated:e.mutated}}return s()(l)||(t.push(l),e.dispatch("kubewarden/updatePolicyTraces",{policyName:r.metadata.name,cluster:null===o||void 0===o?void 0:o.id,updatedTrace:l})),t},[])}if(r===w["e"].POLICY_SERVER)for(const c of a){const e=l(c);s()(e)||n.push({policyName:c.metadata.name,cluster:null===o||void 0===o?void 0:o.id,traces:e})}else{const e=l(i);s()(e)||n.push({policyName:i.metadata.name,cluster:null===o||void 0===o?void 0:o.id,traces:e})}return n}function E(e){const t={};for(const r of e)switch(r.type){case"string":t[r.key]=r.value;break;case"int64":t[r.key]=parseInt(r.value,10);break;case"float64":t[r.key]=parseFloat(r.value);break;case"bool":t[r.key]="true"===r.value;break;default:t[r.key]=r.value}return t}var R=r("7d99"),P=r.n(R),j=r("37ef"),M=r.n(j),x=r("e4c5"),N=r.n(x);c.a.extend(N.a);const L=1e3,D=1e3*L,$=60*D,I=60*$,q=24*I,G=[{unit:"d",microseconds:q,ofPrevious:24},{unit:"h",microseconds:I,ofPrevious:60},{unit:"m",microseconds:$,ofPrevious:60},{unit:"s",microseconds:D,ofPrevious:1e3},{unit:"ms",microseconds:L,ofPrevious:1e3},{unit:"Î¼s",microseconds:1,ofPrevious:1e3}];function V(e){const[t,r]=P()(G,({microseconds:t},r)=>r<G.length-1&&t>e);if(1e3===t.ofPrevious)return`${M()(e/t.microseconds,2)}${t.unit}`;const a=Math.floor(e/t.microseconds),i=`${a}${t.unit}`,o=Math.round(e/r.microseconds%t.ofPrevious),n=`${o}${r.unit}`;return 0===o?i:`${i} ${n}`}var B=function(){var e=this,t=e._self._c;return t("div",[t("p",{staticClass:"checklist__description mb-20",attrs:{"data-testid":"kw-tracing-checklist-description"}},[e._v(" "+e._s(e.t("kubewarden.tracing.description"))+" ")]),t("div",{staticClass:"checklist__prereq mb-20"},[t("h2",[e._v(e._s(e.t("kubewarden.tracing.prerequisites.label")))]),t("p",[e._v(e._s(e.t("kubewarden.tracing.prerequisites.description")))])]),t("Banner",{attrs:{color:"warning",label:e.t("kubewarden.tracing.prerequisites.warning")}}),t("div",{staticClass:"checklist__container mt-20 mb-20"},[t("div",{staticClass:"checklist__step mt-20 mb-20",attrs:{"data-testid":"kw-tracing-checklist-step-open-tel"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.openTelSvc)}),t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.openTelemetry",{},!0),expression:"t('kubewarden.tracing.openTelemetry', {}, true)"}]})]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-tracing-checklist-step-jaeger"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.jaegerQuerySvc)}),t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.jaeger",{},!0),expression:"t('kubewarden.tracing.jaeger', {}, true)"}],attrs:{p:""}})]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-tracing-checklist-step-config"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.tracingEnabled)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.config.label",{},!0),expression:"t('kubewarden.tracing.config.label', {}, true)"}]}),t("button",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.controllerLinkTooltip,expression:"controllerLinkTooltip"}],staticClass:"btn role-primary ml-10",attrs:{"data-testid":"kw-tracing-checklist-step-config-button",disabled:e.controllerLinkDisabled},on:{click:e.controllerAppRoute}},[e._v(" "+e._s(e.t("kubewarden.tracing.config.link"))+" ")])])])])],1)},U=[],Y=r("da25"),H={props:{controllerApp:{type:Object,default:null},controllerChart:{type:Object,default:null},tracingConfiguration:{type:Object,default:null},jaegerQuerySvc:{type:Object,default:null},openTelSvc:{type:Object,default:null}},components:{Banner:f["a"]},computed:{...Object(o["a"])(["currentCluster"]),controllerLinkTooltip(){return this.openTelSvc&&this.jaegerQuerySvc?this.controllerApp&&this.controllerChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Kubewarden Controller"},!0):this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites")},controllerLinkDisabled(){return!this.openTelSvc||!this.jaegerQuerySvc||!this.controllerApp||!this.controllerChart},tracingEnabled(){return this.tracingConfiguration?this.tracingConfiguration.enabled:null}},methods:{badgeIcon(e){return{"icon-dot-open":!e,"icon-checkmark":e,"text-success":e}},controllerAppRoute(){if(this.controllerApp){var e,t,r,a,i,o,n,s;const l=null===(e=this.controllerApp.spec)||void 0===e||null===(t=e.chart)||void 0===t?void 0:t.metadata,c={[Y["g"]]:null===l||void 0===l||null===(r=l.annotations)||void 0===r?void 0:r[v["c"].NAMESPACE],[Y["f"]]:null===l||void 0===l||null===(a=l.annotations)||void 0===a?void 0:a[v["c"].RELEASE_NAME],[Y["q"]]:null===l||void 0===l||null===(i=l.annotations)||void 0===i?void 0:i["catalog.cattle.io/upstream-version"],[Y["i"]]:null===l||void 0===l||null===(o=l.annotations)||void 0===o?void 0:o[v["c"].SOURCE_REPO_NAME],[Y["j"]]:null===l||void 0===l||null===(n=l.annotations)||void 0===n?void 0:n[v["c"].SOURCE_REPO_TYPE],[Y["d"]]:null===l||void 0===l?void 0:l.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:(null===(s=this.currentCluster)||void 0===s?void 0:s.id)||"_"},query:c})}}}},Q=H,F=(r("6478"),r("d802")),z=Object(F["a"])(Q,B,U,!1,null,"63ad3d60",null),J=z.exports;c.a.extend(u.a);var K={props:{resource:{type:String,required:!0},relatedPolicies:{type:Array,default:()=>[]},policy:{type:Object,default:()=>{}}},components:{BadgeState:b["a"],Banner:f["a"],Loading:g["a"],SortableTable:y["b"],TraceChecklist:J},mixins:[h["a"]],async fetch(){const e=[p["a"].APP,p["a"].CLUSTER_REPO,p["y"]],t=[];for(const r of e)this.$store.getters["cluster/canList"](r)&&t.push(this.$fetchType(r));if(await Object(m["a"])(t),this.jaegerQuerySvc){const e={store:this.$store,queryService:this.jaegerQuerySvc,resource:this.resource,relatedPolicies:null,policy:null};this.resource===w["e"].POLICY_SERVER?e.relatedPolicies=this.relatedPolicies:e.policy=this.policy,this.specificValidations=await S(e)}},data(){return{MODE_MAP:w["n"],TRACE_HEADERS:k["g"],OPERATION_MAP:w["o"],specificValidations:null}},computed:{...Object(o["a"])(["currentCluster"]),...Object(o["a"])({charts:"catalog/charts",refreshingCharts:"kubewarden/refreshingCharts"}),allApps(){return this.$store.getters["cluster/all"](p["a"].APP)},allServices(){return this.$store.getters["cluster/all"](p["y"])},controllerApp(){var e;return null===(e=this.allApps)||void 0===e?void 0:e.find(e=>{var t,r,a;return(null===e||void 0===e||null===(t=e.spec)||void 0===t||null===(r=t.chart)||void 0===r||null===(a=r.metadata)||void 0===a?void 0:a.name)===w["g"].CONTROLLER})},controllerChart(){var e;return null===(e=this.charts)||void 0===e?void 0:e.find(e=>e.chartName===w["g"].CONTROLLER)},groupField(){return this.isPolicyServer?"policy_id":null},isPolicyServer(){return this.resource===w["e"].POLICY_SERVER},emptyPolicies(){return this.resource===w["e"].POLICY_SERVER?s()(this.relatedPolicies):s()(this.policy)},emptyTraces(){return s()(this.filteredValidations)},emptyTracesLabel(){return this.resource===w["e"].POLICY_SERVER?"kubewarden.tracing.noRelatedTraces":"kubewarden.tracing.noTraces"},rowsPerPage(){return this.isPolicyServer?40:20},tracingConfiguration(){var e,t,r,a;return this.controllerApp?null===(e=this.controllerApp)||void 0===e||null===(t=e.spec)||void 0===t||null===(r=t.values)||void 0===r||null===(a=r.telemetry)||void 0===a?void 0:a.tracing:null},tracingEnabled(){return this.tracingConfiguration?this.tracingConfiguration.enabled:null},jaegerServices(){var e;return null===(e=this.allServices)||void 0===e?void 0:e.filter(e=>{var t,r;return"jaeger"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(r=t.labels)||void 0===r?void 0:r["app.kubernetes.io/part-of"])})},jaegerQuerySvc(){return s()(this.jaegerServices)?null:this.jaegerServices.find(e=>{var t;const r=null===e||void 0===e||null===(t=e.spec)||void 0===t?void 0:t.ports;if(r.length)return r.find(e=>16685===e.port||16686===e.port)})},openTelemetryServices(){var e;return null===(e=this.allServices)||void 0===e?void 0:e.filter(e=>{var t,r;return"opentelemetry-operator"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(r=t.labels)||void 0===r?void 0:r[v["h"].MANAGED_NAME])})},openTelSvc(){return s()(this.openTelemetryServices)?null:this.openTelemetryServices.find(e=>{var t;const r=null===e||void 0===e||null===(t=e.spec)||void 0===t?void 0:t.ports;if(r.length)return r.find(e=>8080===e.port)})},showChecklist(){var e;return!this.openTelSvc||!this.jaegerQuerySvc||!(null!==(e=this.tracingConfiguration)&&void 0!==e&&e.enabled)},showTable(){return!this.emptyPolicies&&!this.showChecklist&&!this.emptyTraces},filteredValidations(){return s()(this.specificValidations)?[]:this.specificValidations.flatMap(e=>{var t;return(null===(t=this.currentCluster)||void 0===t?void 0:t.id)===e.cluster?e.traces:[]})}},methods:{modeColor(e){return this.MODE_MAP[e]},opColor(e){return this.OPERATION_MAP[e]},formatTime(e){return c()(e/1e3)},duration(e){return V(e)}}},W=K,X=(r("c31d"),Object(F["a"])(W,a,i,!1,null,"23448538",null));t["a"]=X.exports},2192:function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".checklist__container[data-v-63ad3d60]{display:flex;justify-content:center;flex-direction:column;border:1px solid var(--border);padding:10px}.checklist__config[data-v-63ad3d60],.checklist__step[data-v-63ad3d60]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}.checklist__step[data-v-63ad3d60]{min-height:40px}",""]),e.exports=t},"284d":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading"):t("div",[e.policyGauges?[t("div",{staticClass:"row"},[[t("div",{staticClass:"col span-6"},[t("h3",{attrs:{"data-testid":"kw-ps-detail-status-title"}},[e._v(" "+e._s(e.t("kubewarden.policyServer.policyGauge.byStatus"))+" ")]),t("div",{staticClass:"gauges mb-20"},e._l(e.policyGauges,(function(r,a){return t("CountGauge",{key:a,attrs:{total:e.relatedPoliciesTotal,useful:r.count||0,graphical:!1,"primary-color-var":"--sizzle-"+r.color,name:a}})})),1)])],e.emptyTraces?e._e():[t("div",{staticClass:"col span-6"},[t("h3",[e._v(" "+e._s(e.t("kubewarden.policyServer.policyGauge.traces"))+" ")]),t("div",{staticClass:"gauges mb-20"},e._l(e.tracesGauges,(function(r,a){return t("CountGauge",{key:a,attrs:{useful:r.count||0,total:e.traceGaugeTotals,graphical:!1,"primary-color-var":"--sizzle-"+r.color,name:a}})})),1)])]],2)]:e._e(),t("ResourceTabs",{attrs:{mode:e.mode},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[t("Tab",{attrs:{name:"related-policies",label:"Policies",weight:99},scopedSlots:e._u([{key:"default",fn:function(){return[t("ResourceTable",{attrs:{rows:e.relatedPolicies||[],headers:e.RELATED_HEADERS,groupable:!0,"group-by":e.groupPreference,"table-actions":!0,"data-testid":"kw-ps-detail-related-policies-list"},scopedSlots:e._u([{key:"col:operation",fn:function({row:r}){return[t("td",[t("BadgeState",{attrs:{"data-testid":`kw-ps-detail-${r.id}-state`,label:r.operation,color:e.color(r.operation)}})],1)]}}])})]},proxy:!0}])}),t("Tab",{staticClass:"relative",attrs:{name:"policy-tracing",label:"Tracing",weight:98}},[t("TraceTable",{attrs:{resource:e.resource,"related-policies":e.relatedPolicies}})],1),t("Tab",{staticClass:"relative",attrs:{name:"policy-metrics",label:"Metrics",weight:97},scopedSlots:e._u([{key:"default",fn:function(r){return[t("MetricsTab",{attrs:{resource:e.resource,"policy-server-obj":e.value,active:r.active}})]}}])})],1)],2)},i=[],o=r("9ce4"),n=r("330a"),s=r.n(n),l=r("da25"),c=r("a8b9"),d=r("305c"),u=r("5000"),p=r("74c2"),v=r("15ca"),h=r("c422"),m=r("126f"),b=r("38de"),f=r("5191"),g=r("3f46"),y=r("00ce"),k={name:"PolicyServer",components:{CountGauge:p["a"],Loading:v["a"],MetricsTab:g["a"],ResourceTabs:h["a"],ResourceTable:m["a"],Tab:b["a"],TraceTable:y["a"]},mixins:[d["a"]],props:{mode:{type:String,default:l["t"]},resource:{type:String,default:null},value:{type:Object,required:!0}},async fetch(){const e=await Object(c["a"])({relatedPolicies:this.value.allRelatedPolicies(),policyGauges:this.value.policyGauges()}),t=(e,t)=>{s()(t)||(this[e]=t)};t("relatedPolicies",e.relatedPolicies),t("policyGauges",e.policyGauges)},data(){return{RELATED_HEADERS:f["e"],policyGauges:null,relatedPolicies:null,reloadRequired:!1}},computed:{...Object(o["a"])(["currentCluster","currentProduct"]),...Object(o["a"])({policyTraces:"kubewarden/policyTraces"}),_group:Object(u["n"])(u["e"]),filteredTraces(){return s()(this.policyTraces)?null:this.policyTraces.filter(e=>{var t;if((null===(t=this.currentCluster)||void 0===t?void 0:t.id)===e.cluster)return e})},emptyTraces(){return s()(this.filteredTraces)},groupPreference(){const e="namespace"===this._group?"kind":null;return e},relatedPoliciesTotal(){return s()(this.relatedPolicies)?0:this.relatedPolicies.length},tracesGauges(){return this.emptyTraces?null:this.value.tracesGauges(this.filteredTraces)},traceGaugeTotals(){var e;return this.emptyTraces?0:null===(e=this.filteredTraces)||void 0===e?void 0:e.flatMap(e=>e.traces).length}},methods:{hasNamespaceSelector(e){return e.namespaceSelector}}},w=k,_=(r("83c2"),r("d802")),C=Object(_["a"])(w,a,i,!1,null,"f0c52164",null);t["default"]=C.exports},"3f46":function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading",{attrs:{mode:"relative"}}):t("div",[e.showChecklist?t("MetricsChecklist",{attrs:{"cattle-dashboard-ns":e.cattleDashboardNs,"controller-app":e.controllerApp,"controller-chart":e.controllerChart,"kubewarden-service-monitor":e.kubewardenServiceMonitor,"kubewarden-dashboards":e.kubewardenGrafanaDashboards,"monitoring-app":e.monitoringApp,"monitoring-chart":e.monitoringChart,"open-tel-svc":e.openTelSvc,"policy-obj":e.policyObj,"policy-server-obj":e.policyServerObj},on:{updateServiceMonitors:e.updateServiceMonitors}}):e._e(),e.showChecklist?e._e():[e.monitoringApp&&!e.metricsProxy?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.monitoring.warning.noProxy")}}):e._e(),e.metricsProxy&&e.active?t("DashboardMetrics",{attrs:{"data-testid":"kw-ps-metrics-dashboard","detail-url":e.metricsProxy,"summary-url":e.metricsProxy,"graph-height":"825px"}}):e._e()]],2)},i=[],o=r("9ce4"),n=r("330a"),s=r.n(n),l=r("907c"),c=r("4ac6"),d=r("b45b"),u=r("f390"),p=r("a8b9"),v=r("2359"),h=r("c389"),m=r("15ca"),b=r("6418"),f=r("90cd"),g=r("e9a3"),y=r("541d");async function k(e){const{store:t,type:r}=e;try{const e=await w(t);if(!s()(e)){const t=`/api/v1/namespaces/${e.metadata.namespace}/services`,a=`/http:${e.metadata.name}:80/proxy`,i=`/d/${r}?orgId=1&kiosk`;return t+a+i}}catch(a){Object(g["a"])({error:a,store:t,type:"warning"})}return null}async function w(e){try{return await e.dispatch("cluster/find",{type:l["y"],id:"cattle-monitoring-system/rancher-monitoring-grafana"},{root:!0})}catch(t){Object(g["a"])({error:t,store:e,type:"warning"})}}async function _(e){try{return await e.dispatch("cluster/findMatching",{type:l["b"],selector:"kubewarden/part-of=cattle-kubewarden-system"})}catch(t){Object(g["a"])({error:t,store:e,type:"warning"})}}async function C(e){const{store:t,monitoringApp:a,controllerApp:i}=e;if(a&&i){const e=Object.values(f["m"]);for(const s of e){var o;const e=await r("cb8a")(`./${s}.json`),c=s+".json",d=await _(t);if(d&&(null===d||void 0===d||null===(o=d.metadata)||void 0===o?void 0:o.name)===s)return;const u={[f["l"].DASHBOARD]:s,[f["l"].PART_OF]:i.metadata.namespace,[f["l"].APP]:"rancher-monitoring-grafana",[f["l"].GRAFANA_DASHBOARD]:"1","app.kubernetes.io/instance":a.metadata.name},p={[f["d"].NAME]:a.metadata.name,[f["d"].NAMESPACE]:a.metadata.namespace},v=await t.dispatch("cluster/create",{type:l["b"],metadata:{annotations:p,labels:u,name:s,namespace:"cattle-dashboards"},data:{[c]:JSON.stringify(e)}});try{await v.save()}catch(n){Object(g["a"])({error:n,store:t})}}}}function S(e){const{policyObj:t,policyServerObj:r,allServiceMonitors:a}=e;if(!s()(a)){var i;const e=t?null===(i=t.spec)||void 0===i?void 0:i.policyServer:null===r||void 0===r?void 0:r.id;return null===a||void 0===a?void 0:a.find(t=>{var r,a,i;return(null===t||void 0===t||null===(r=t.spec)||void 0===r||null===(a=r.selector)||void 0===a||null===(i=a.matchLabels)||void 0===i?void 0:i["app"])==="kubewarden-policy-server-"+e})}}async function T(e){const{store:t,policyObj:r,policyServerObj:a,controllerNs:i,serviceMonitor:o}=e;if(t.getters["cluster/schemaFor"](l["l"].SERVICEMONITOR)){var n;const e=r?null===(n=r.spec)||void 0===n?void 0:n.policyServer:null===a||void 0===a?void 0:a.id,c={kind:"ServiceMonitor",type:l["l"].SERVICEMONITOR,metadata:{name:e,namespace:i},spec:{endpoints:[{interval:"10s",port:"metrics"}],namespaceSelector:{matchNames:[i]},selector:{matchLabels:{app:"kubewarden-policy-server-"+e}}}};if(!o){const e=await t.dispatch("cluster/create",c);try{await e.save()}catch(s){Object(g["a"])({error:s,store:t})}}}}var O=function(){var e=this,t=e._self._c;return t("div",{staticClass:"checklist__container"},[t("div",{staticClass:"checklist__prereq mb-20"},[t("h2",[e._v(e._s(e.t("kubewarden.monitoring.prerequisites.label")))]),t("p",[e._v(e._s(e.t("kubewarden.monitoring.prerequisites.description")))])]),t("Banner",{attrs:{color:"warning",label:e.t("kubewarden.monitoring.prerequisites.warning")}}),t("div",{staticClass:"mt-20 mb-20"},[t("div",{staticClass:"checklist__step mt-20 mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-open-tel"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.openTelSvc)}),t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.openTelemetry",{},!0),expression:"t('kubewarden.tracing.openTelemetry', {}, true)"}]})]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-monitoring-app"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.monitoringApp)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.monitoringApp.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.monitoringApp.label', {}, true)"}],attrs:{p:""}}),e.monitoringApp?e._e():t("button",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.monitoringLinkTooltip,expression:"monitoringLinkTooltip"}],staticClass:"btn role-primary ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-config-button",disabled:!e.monitoringChart},on:{click:function(t){return e.monitoringAppRoute()}}},[e._v(" "+e._s(e.monitoringChartLink)+" ")])])]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-service-monitor-map"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.kubewardenServiceMonitor)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.serviceMonitor.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.serviceMonitor.label', {}, true)"}],attrs:{p:""}}),e.kubewardenServiceMonitor?e._e():t("AsyncButton",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.serviceMonitorsTooltip,expression:"serviceMonitorsTooltip"}],staticClass:"ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-service-monitor-button",mode:"serviceMonitor",disabled:e.serviceMonitorButtonDisabled},on:{click:e.addServiceMonitor}})],1)]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-config-map"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.hasKubewardenDashboards)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.configMap.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.configMap.label', {}, true)"}],attrs:{p:""}}),e.hasKubewardenDashboards?e._e():t("AsyncButton",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.dashboardsTooltip,expression:"dashboardsTooltip"}],staticClass:"ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-config-map-button",mode:"grafanaDashboard",disabled:e.dashboardButtonDisabled},on:{click:e.addDashboards}})],1)]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-controller-config"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.metricsEnabled)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.controllerConfig.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.controllerConfig.label', {}, true)"}],attrs:{p:""}}),e.metricsEnabled?e._e():t("button",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.controllerLinkTooltip,expression:"controllerLinkTooltip"}],staticClass:"btn role-primary ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-config-button",disabled:e.controllerLinkDisabled},on:{click:function(t){return e.controllerAppRoute()}}},[e._v(" "+e._s(e.t("kubewarden.monitoring.prerequisites.controllerConfig.button"))+" ")])])])])],1)},A=[],E=r("da25"),R=r("d709"),P={props:{cattleDashboardNs:{type:Object,default:null},controllerApp:{type:Object,default:null},controllerChart:{type:Object,default:null},kubewardenServiceMonitor:{type:Object,default:null},kubewardenDashboards:{type:Array,default:null},monitoringApp:{type:Object,default:null},monitoringChart:{type:Object,default:null},openTelSvc:{type:Object,default:null},policyObj:{type:Object,default:null},policyServerObj:{type:Object,default:null}},components:{AsyncButton:R["b"],Banner:b["a"]},computed:{...Object(o["a"])(["currentCluster"]),...Object(o["a"])({t:"i18n/t"}),controllerMetricsConfig(){var e,t,r;return this.controllerApp?null===(e=this.controllerApp.spec)||void 0===e||null===(t=e.values)||void 0===t||null===(r=t.telemetry)||void 0===r?void 0:r.metrics:null},controllerLinkDisabled(){return!this.openTelSvc||!this.monitoringApp||!this.hasKubewardenDashboards||!this.controllerChart||!this.controllerApp},controllerLinkTooltip(){return this.controllerLinkDisabled?this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites"):this.controllerChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Kubewarden Controller"},!0)},dashboardsTooltip(){return this.monitoringApp?this.monitoringApp&&s()(this.cattleDashboardNs)?this.t("kubewarden.monitoring.prerequisites.tooltips.nsNotFound"):null:this.t("kubewarden.monitoring.prerequisites.tooltips.appNotInstalled",{app:"Rancher Monitoring"},!0)},dashboardButtonDisabled(){return!this.monitoringApp||s()(this.cattleDashboardNs)},hasKubewardenDashboards(){return!s()(this.kubewardenDashboards)},metricsEnabled(){return this.controllerMetricsConfig?this.controllerMetricsConfig.enabled:null},monitoringChartLink(){return this.monitoringApp?this.t("kubewarden.monitoring.prerequisites.monitoringApp.edit"):this.t("kubewarden.monitoring.prerequisites.monitoringApp.install")},monitoringLinkTooltip(){return this.monitoringChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Rancher Monitoring"},!0)},serviceMonitorButtonDisabled(){return!this.controllerApp||!this.monitoringApp},serviceMonitorsTooltip(){return this.monitoringApp?!this.kubewardenServiceMonitor&&this.controllerApp?this.t("kubewarden.monitoring.prerequisites.tooltips.monitorsNotFound",{namespace:null===(e=this.controllerApp.metadata)||void 0===e?void 0:e.namespace},!0):null:this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites");var e}},methods:{async addDashboards(e){try{await C({store:this.$store,monitoringApp:this.monitoringApp,controllerApp:this.controllerApp}),e(!0)}catch(t){Object(g["a"])({error:t,store:this.$store}),e(!1)}},async addServiceMonitor(e){try{var t,r;await T({store:this.$store,policyObj:this.policyObj,policyServerObj:this.policyServerObj,controllerNs:null===(t=this.controllerApp)||void 0===t||null===(r=t.metadata)||void 0===r?void 0:r.namespace,serviceMonitor:this.kubewardenServiceMonitor}),this.$emit("updateServiceMonitors"),e(!0)}catch(a){Object(g["a"])({error:a,store:this.$store}),e(!1)}},badgeIcon(e){if(Array.isArray(e)){const t=s()(e);return{"icon-dot-open":t,"icon-checkmark":!t,"text-success":!t}}return{"icon-dot-open":!e,"icon-checkmark":e,"text-success":e}},monitoringAppRoute(){if(!this.monitoringApp&&this.monitoringChart&&this.monitoringChart.goToInstall(),this.monitoringApp){var e,t,r,a,i,o,n,s,l,d,u,p,v,h,m,b,f;const g={[E["g"]]:null===(e=this.monitoringApp.metadata)||void 0===e?void 0:e.namespace,[E["f"]]:null===(t=this.monitoringApp.metadata)||void 0===t?void 0:t.name,[E["q"]]:null===(r=this.monitoringApp.spec)||void 0===r||null===(a=r.chart)||void 0===a||null===(i=a.metadata)||void 0===i?void 0:i.version,[E["i"]]:null===(o=this.monitoringApp.spec)||void 0===o||null===(n=o.chart)||void 0===n||null===(s=n.metadata)||void 0===s||null===(l=s.annotations)||void 0===l?void 0:l[c["c"].SOURCE_REPO_NAME],[E["j"]]:null===(d=this.monitoringApp.spec)||void 0===d||null===(u=d.chart)||void 0===u||null===(p=u.metadata)||void 0===p||null===(v=p.annotations)||void 0===v?void 0:v[c["c"].SOURCE_REPO_TYPE],[E["d"]]:null===(h=this.monitoringApp.spec)||void 0===h||null===(m=h.chart)||void 0===m||null===(b=m.metadata)||void 0===b?void 0:b.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:(null===(f=this.currentCluster)||void 0===f?void 0:f.id)||"_"},query:g})}},controllerAppRoute(){if(this.controllerApp){var e,t,r,a,i,o,n,s;const l=null===(e=this.controllerApp.spec)||void 0===e||null===(t=e.chart)||void 0===t?void 0:t.metadata,d={[E["g"]]:null===l||void 0===l||null===(r=l.annotations)||void 0===r?void 0:r[c["c"].NAMESPACE],[E["f"]]:null===l||void 0===l||null===(a=l.annotations)||void 0===a?void 0:a[c["c"].RELEASE_NAME],[E["q"]]:null===l||void 0===l||null===(i=l.annotations)||void 0===i?void 0:i["catalog.cattle.io/upstream-version"],[E["i"]]:null===l||void 0===l||null===(o=l.annotations)||void 0===o?void 0:o[c["c"].SOURCE_REPO_NAME],[E["j"]]:null===l||void 0===l||null===(n=l.annotations)||void 0===n?void 0:n[c["c"].SOURCE_REPO_TYPE],[E["d"]]:null===l||void 0===l?void 0:l.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:(null===(s=this.currentCluster)||void 0===s?void 0:s.id)||"_"},query:d})}}}},j=P,M=(r("d8d6"),r("d802")),x=Object(M["a"])(j,O,A,!1,null,"60c912a1",null),N=x.exports,L={props:{active:{type:Boolean,default:null},resource:{type:String,default:null},policyObj:{type:Object,default:null},policyServerObj:{type:Object,default:null}},components:{Banner:b["a"],DashboardMetrics:h["a"],Loading:m["a"],MetricsChecklist:N},mixins:[v["a"]],async fetch(){const e=[{name:l["a"].APP,property:this.allApps},{name:l["a"].CLUSTER_REPO,property:this.allRepos},{name:l["b"],property:this.allConfigMaps},{name:f["e"].POLICY_SERVER,property:this.allPolicyServers},{name:l["l"].SERVICEMONITOR,property:this.allServiceMonitors},{name:l["m"],property:this.allNamespaces},{name:l["y"],property:this.allServices}],t=[];for(const i of e)s()(i.property)&&this.$store.getters["cluster/canList"](i.name)&&t.push(this.$fetchType(i.name));if(await Object(p["a"])(t),this.showChecklist&&!this.monitoringChart&&await Object(y["a"])({store:this.$store,init:!0}),this.monitoringStatus.installed)try{var r;if(this.metricsProxy=await k({store:this.$store,type:this.METRICS_TYPE}),this.metricsProxy)this.metricsService=await Object(d["b"])("v2",this.$store,null===(r=this.currentCluster)||void 0===r?void 0:r.id,this.metricsProxy)}catch(a){const e={_statusText:"Error",message:"Error fetching Grafana Service: "+a};Object(g["a"])({error:e,store:this.$store})}},data(){const e=this.resource===f["e"].POLICY_SERVER?f["m"].POLICY_SERVER:f["m"].POLICY;return{METRICS_TYPE:e,[l["a"].APP]:null,[l["a"].CLUSTER_REPO]:null,[l["b"]]:null,[l["l"].SERVICEMONITOR]:null,[l["y"]]:null,metricsProxy:null,metricsService:null}},watch:{async grafanaService(){var e;this.metricsProxy||(this.metricsProxy=await k({store:this.$store,type:this.METRICS_TYPE}),this.metricsProxy&&(this.metricsService=await Object(d["b"])("v2",this.$store,null===(e=this.currentCluster)||void 0===e?void 0:e.id,this.metricsProxy)))}},computed:{...Object(o["a"])(["currentCluster","productId"]),...Object(o["a"])({charts:"catalog/charts"}),...Object(u["c"])(),allApps(){return this.$store.getters["cluster/all"](l["a"].APP)},allRepos(){return this.$store.getters["cluster/all"](l["a"].CLUSTER_REPO)},allConfigMaps(){return this.$store.getters["cluster/all"](l["b"])},allNamespaces(){return this.$store.getters["cluster/all"](l["m"])},allPolicyServers(){return this.$store.getters["cluster/all"](f["e"].POLICY_SERVER)},allServiceMonitors(){return this.$store.getters["cluster/all"](l["l"].SERVICEMONITOR)},allServices(){return this.$store.getters["cluster/all"](l["y"])},cattleDashboardNs(){return this.allNamespaces.find(e=>{var t;return"cattle-dashboards"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name)})},controllerApp(){var e;return null===(e=this.allApps)||void 0===e?void 0:e.find(e=>{var t,r,a;return(null===e||void 0===e||null===(t=e.spec)||void 0===t||null===(r=t.chart)||void 0===r||null===(a=r.metadata)||void 0===a?void 0:a.name)===f["g"].CONTROLLER})},controllerChart(){var e;return null===(e=this.charts)||void 0===e?void 0:e.find(e=>e.chartName===f["g"].CONTROLLER)},grafanaService(){var e;const t=null===(e=this.allServices)||void 0===e?void 0:e.filter(e=>{var t,r;return"rancher-monitoring"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(r=t.labels)||void 0===r?void 0:r["app.kubernetes.io/instance"])});return null===t||void 0===t?void 0:t.find(e=>{var t,r;return"grafana"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(r=t.labels)||void 0===r?void 0:r["app.kubernetes.io/name"])})},kubewardenGrafanaDashboards(){return this.allConfigMaps.filter(e=>{var t,r;return null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(r=t.labels)||void 0===r?void 0:r[f["l"].DASHBOARD]})},kubewardenServiceMonitor(){var e,t;return S({policyObj:this.policyObj,policyServerObj:this.policyServerObj,controllerNs:null===(e=this.controllerApp)||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.namespace,allServiceMonitors:this.allServiceMonitors})},monitoringApp(){var e;return null===(e=this.allApps)||void 0===e?void 0:e.find(e=>{var t,r,a;return"rancher-monitoring"===(null===e||void 0===e||null===(t=e.spec)||void 0===t||null===(r=t.chart)||void 0===r||null===(a=r.metadata)||void 0===a?void 0:a.name)})},monitoringChart(){var e;return null===(e=this.charts)||void 0===e?void 0:e.find(e=>"rancher-monitoring"===e.chartName)},openTelemetryServices(){return this.allServices?this.allServices.filter(e=>{var t,r;return"opentelemetry-operator"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(r=t.labels)||void 0===r?void 0:r[c["h"].MANAGED_NAME])}):null},openTelSvc(){return s()(this.openTelemetryServices)?null:this.openTelemetryServices.find(e=>{var t;const r=null===e||void 0===e||null===(t=e.spec)||void 0===t?void 0:t.ports;if(r.length)return r.find(e=>8080===e.port)})},policyServerSvcs(){if(!s()(this.allPolicyServers)){const t=this.allPolicyServers.map(e=>{var t;return null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name}),r=[];for(const a of t){var e;r.push(null===(e=this.allServices)||void 0===e?void 0:e.find(e=>{var t,r;return(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(r=t.labels)||void 0===r?void 0:r.app)==="kubewarden-policy-server-"+a}))}return r}return null},showChecklist(){var e,t,r,a,i;const o=null===(e=this.controllerApp)||void 0===e||null===(t=e.spec)||void 0===t||null===(r=t.values)||void 0===r||null===(a=r.telemetry)||void 0===a||null===(i=a.metrics)||void 0===i?void 0:i.enabled,n=!s()(this.kubewardenGrafanaDashboards);return!this.openTelSvc||!this.monitoringApp||!this.kubewardenServiceMonitor||!o||!n}},methods:{async updateServiceMonitors(){await this.$fetchType(l["l"].SERVICEMONITOR)}}},D=L,$=Object(M["a"])(D,a,i,!1,null,null,null);t["a"]=$.exports},"481f":function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".sub-row[data-v-23448538]{background-color:var(--body-bg);border-bottom:1px solid var(--sortable-table-top-divider);padding-left:1rem;padding-right:1rem}.details[data-v-23448538]{display:grid;grid-auto-flow:column;grid-auto-columns:minmax(0,1fr);gap:1em}.details .col[data-v-23448538]{display:flex;flex-direction:column}.details .col section[data-v-23448538]{margin-bottom:1.5rem}.details .col .title[data-v-23448538]{color:var(--muted);margin-bottom:.5rem}",""]),e.exports=t},4937:function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".checklist__container[data-v-60c912a1]{display:flex;justify-content:center;flex-direction:column;border:1px solid var(--border);padding:10px}.checklist__config[data-v-60c912a1],.checklist__step[data-v-60c912a1]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}.checklist__step[data-v-60c912a1]{min-height:40px}",""]),e.exports=t},"4cbe":function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".relative[data-v-f0c52164]{position:relative}.policy__mode[data-v-f0c52164]{display:flex;align-items:center}.policy__mode i[data-v-f0c52164]{margin-left:5px;font-size:22px;color:var(--warning)}.gauges[data-v-f0c52164],.gaugesContainer[data-v-f0c52164]{display:flex}.gauges[data-v-f0c52164]{justify-content:space-around;flex-wrap:wrap;justify-content:left}.gauges .count-gauge[data-v-f0c52164]{width:46%;margin-bottom:10px;flex:initial}.gauges>*[data-v-f0c52164]{flex:1;margin-right:1.75%}",""]),e.exports=t},6478:function(e,t,r){"use strict";r("6e05")},"6e05":function(e,t,r){var a=r("2192");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("6af1f964",a,!0,{sourceMap:!1,shadowMode:!1})},"733f":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("PolicyDetail",{attrs:{value:e.value,mode:e.mode,resource:e.resource}})},i=[],o=r("da25"),n=r("80db"),s={name:"AdmissionPolicy",props:{mode:{type:String,default:o["t"]},resource:{type:String,default:null},value:{type:Object,required:!0}},components:{PolicyDetail:n["a"]}},l=s,c=r("d802"),d=Object(c["a"])(l,a,i,!1,null,null,null);t["default"]=d.exports},7649:function(e,t,r){var a=r("4937");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("33d2927c",a,!0,{sourceMap:!1,shadowMode:!1})},"80db":function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"mb-20"},[t("h3",[e._v(e._s(e.t("namespace.resources")))])]),t("ResourceTabs",{attrs:{"data-testid":"kw-policy-detail-tabs",mode:e.mode,"need-related":e.hasRelationships},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[e.policyReadme?t("Tab",{attrs:{name:"policy-readme",label:"Readme",weight:99}},[t("Markdown",{attrs:{"data-testid":"kw-policy-detail-readme"},model:{value:e.policyReadme,callback:function(t){e.policyReadme=t},expression:"policyReadme"}})],1):e._e(),e.hasRules?t("Tab",{attrs:{name:"policy-rules",label:"Rules",weight:98}},[t("RulesTable",{attrs:{rows:e.rulesRows,"data-testid":"kw-policy-detail-rules-table"}})],1):e._e(),t("Tab",{attrs:{name:"policy-tracing",label:"Tracing",weight:97}},[t("TraceTable",{attrs:{resource:e.resource,policy:e.value,"data-testid":"kw-policy-detail-trace-table"}})],1),t("Tab",{attrs:{name:"policy-metrics",label:"Metrics",weight:96},scopedSlots:e._u([{key:"default",fn:function(r){return[t("MetricsTab",{attrs:{resource:e.resource,"policy-obj":e.value,active:r.active}})]}}])})],1)],1)},i=[],o=r("9ce4"),n=r("330a"),s=r.n(n),l=r("da25"),c=r("f390"),d=r("305c"),u=r("56dc"),p=r("c422"),v=r("38de"),h=r("90cd"),m=r("3f46"),b=function(){var e=this,t=e._self._c;return t("div",[e.rows.length>0?t("SortableTable",{attrs:{"data-testid":"kw-policy-rules-sortable-table",rows:e.rows,headers:e.RULE_HEADERS,"table-actions":!1,"row-actions":!1,"key-field":"traceID","default-sort-by":"startTime"},scopedSlots:e._u([{key:"col:apiGroup",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(r.apiGroups||"-"))])])]}},{key:"col:apiVersion",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(r.apiVersions||"-"))])])]}},{key:"col:operations",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(e.joinColumn(r.operations)))])])]}},{key:"col:resources",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(e.joinColumn(r.resources)))])])]}}],null,!1,1857136105)}):t("div",[t("Banner",{staticClass:"type-banner mb-20 mt-0",attrs:{color:"warning",label:e.t("kubewarden.policies.noRules")}})],1)],1)},f=[],g=r("6418"),y=r("0fb1"),k=r("5191"),w={props:{rows:{type:Array,default:()=>[]}},components:{Banner:g["a"],SortableTable:y["b"]},data(){return{RULE_HEADERS:k["f"]}},methods:{joinColumn(e){return(null===e||void 0===e?void 0:e.join(", "))||""}}},_=w,C=r("d802"),S=Object(C["a"])(_,b,f,!1,null,null,null),T=S.exports,O=r("00ce"),A={name:"PolicyDetail",components:{Markdown:u["a"],MetricsTab:m["a"],ResourceTabs:p["a"],RulesTable:T,Tab:v["a"],TraceTable:O["a"]},mixins:[d["a"]],props:{mode:{type:String,default:l["t"]},resource:{type:String,default:null},value:{type:Object,required:!0}},async mounted(){var e,t,r;if(null!==(e=this.value)&&void 0!==e&&null!==(t=e.metadata)&&void 0!==t&&null!==(r=t.annotations)&&void 0!==r&&r[h["b"]])try{const e=await this.value.artifactHubPackageVersion();e&&!e.error&&e.readme&&(this.policyReadme=JSON.parse(JSON.stringify(e.readme)))}catch(a){console.warn("Unable to fetch artifacthub package: "+a)}},data(){return{policyReadme:null}},computed:{...Object(o["a"])(["currentCluster"]),...Object(c["c"])(),dashboardVars(){var e;return{policy_name:"clusterwide-"+(null===(e=this.value)||void 0===e?void 0:e.id)}},hasRelationships(){var e,t;return!(null===(e=this.value)||void 0===e||null===(t=e.metadata)||void 0===t||!t.relationships)},hasRules(){var e;return!s()(null===(e=this.rulesRows)||void 0===e?void 0:e[0])},rulesRows(){var e,t;return null===(e=this.value)||void 0===e||null===(t=e.spec)||void 0===t?void 0:t.rules}}},E=A,R=Object(C["a"])(E,a,i,!1,null,null,null);t["a"]=R.exports},"83c2":function(e,t,r){"use strict";r("ced8")},b3e2:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("PolicyDetail",{attrs:{value:e.value,mode:e.mode,resource:e.resource}})},i=[],o=r("da25"),n=r("80db"),s={name:"ClusterAdmissionPolicy",props:{mode:{type:String,default:o["t"]},resource:{type:String,default:null},value:{type:Object,required:!0}},components:{PolicyDetail:n["a"]}},l=s,c=r("d802"),d=Object(c["a"])(l,a,i,!1,null,null,null);t["default"]=d.exports},c31d:function(e,t,r){"use strict";r("e438")},cb8a:function(e,t,r){var a={"./kubewarden-dashboard-policy.json":["ec40",8],"./kubewarden-dashboard-policyserver.json":["82e7",9]};function i(e){if(!r.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],i=t[0];return r.e(t[1]).then((function(){return r.t(i,3)}))}i.keys=function(){return Object.keys(a)},i.id="cb8a",e.exports=i},ced8:function(e,t,r){var a=r("4cbe");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("28d27682",a,!0,{sourceMap:!1,shadowMode:!1})},d8d6:function(e,t,r){"use strict";r("7649")},e438:function(e,t,r){var a=r("481f");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("56d4f326",a,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=kubewarden-1.3.3.umd.min.detail.js.map