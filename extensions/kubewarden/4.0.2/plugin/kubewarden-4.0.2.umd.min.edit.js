(("undefined"!==typeof self?self:this)["webpackChunkkubewarden_4_0_2"]=("undefined"!==typeof self?self:this)["webpackChunkkubewarden_4_0_2"]||[]).push([[739],{882:function(e,t,a){"use strict";a.r(t);var o=a(36758),r=a.n(o),s=a(40935),l=a.n(s),n=l()(r());n.push([e.id,"[data-v-788fd4b0] .cru__footer{z-index:1}",""]),t["default"]=n},2023:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return I}});var o=a(9274);const r={key:0,id:"cru-errors",class:"cru__errors"};function s(e,t,a,s,l,n){const i=(0,o.resolveComponent)("Loading"),c=(0,o.resolveComponent)("Values"),u=(0,o.resolveComponent)("Banner"),d=(0,o.resolveComponent)("CruResource");return e.$fetchState.pending?((0,o.openBlock)(),(0,o.createBlock)(i,{key:0,mode:"relative"})):((0,o.openBlock)(),(0,o.createBlock)(d,{key:1,resource:a.value,mode:a.realMode,"can-yaml":!1,"done-route":e.doneRoute,errors:e.errors,"validation-passed":n.validationPassed,onFinish:n.finish},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{value:a.value,"chart-values":l.chartValues,mode:a.mode},null,8,["value","chart-values","mode"]),n.hasErrors?((0,o.openBlock)(),(0,o.createElementBlock)("div",r,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.errors,((e,t)=>((0,o.openBlock)(),(0,o.createBlock)(u,{key:t,color:"error","data-testid":`error-banner${t}`,closable:!0,onClose:e=>n.closeError(t)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e),1)])),_:2},1032,["data-testid","onClose"])))),128))])):(0,o.createCommentVNode)("",!0)])),_:1},8,["resource","mode","done-route","errors","validation-passed","onFinish"]))}var l=a(82451),n=a.n(l),i=a(14220),c=a(91825),u=a(9980),d=a(46037),p=a(84409),h=a(18368),m=a(56505);const f={key:1,class:"scroll__container"},v={key:0,class:"step__values__controls"},y={class:"scroll__content"};function b(e,t,a,r,s,l){const n=(0,o.resolveComponent)("Loading"),i=(0,o.resolveComponent)("ButtonGroup"),c=(0,o.resolveComponent)("Tabbed"),u=(0,o.resolveComponent)("YamlEditor"),d=(0,o.resolveComponent)("ResourceCancelModal");return e.$fetchState.pending?((0,o.openBlock)(),(0,o.createBlock)(n,{key:0,mode:"relative"})):((0,o.openBlock)(),(0,o.createElementBlock)("div",f,[l.isCreate||l.isEdit?((0,o.openBlock)(),(0,o.createElementBlock)("div",v,[(0,o.createVNode)(i,{value:s.yamlOption,"onUpdate:value":t[0]||(t[0]=e=>s.yamlOption=e),"data-testid":"kw-policy-server-config-yaml-option",options:s.YAML_OPTIONS,"inactive-class":"bg-disabled btn-sm","active-class":"bg-primary btn-sm"},null,8,["value","options"])])):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",y,[s.showForm?((0,o.openBlock)(),(0,o.createBlock)(c,{key:0,ref:"tabs","side-tabs":!0,class:"step__values__content",onChanged:t[2]||(t[2]=e=>l.tabChanged(e))},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(),(0,o.createBlock)((0,o.resolveDynamicComponent)(s.valuesComponent),{value:s.values,"onUpdate:value":t[1]||(t[1]=e=>s.values=e),resource:a.value,mode:a.mode,onValidationPassed:l.handleValidationPassed},null,40,["value","resource","mode","onValidationPassed"]))])),_:1},512)):!l.isCreate&&!l.isEdit||s.showForm?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(u,{key:1,ref:"yaml",value:s.currentYamlValues,"onUpdate:value":t[3]||(t[3]=e=>s.currentYamlValues=e),"data-testid":"kw-policy-server-config-yaml-editor",class:"step__values__content",scrolling:!0,"initial-yaml-values":s.originalYamlValues,"editor-mode":l.editorMode,"hide-preview-buttons":!0,onOnChanges:l.updateYamlValues},null,8,["value","initial-yaml-values","editor-mode","onOnChanges"])),(0,o.createVNode)(d,{ref:"cancelModal","data-testid":"kw-policy-server-config-yaml-cancel","is-cancel-modal":!1,"is-form":!0,onCancelCancel:t[4]||(t[4]=e=>s.preYamlOption=s.yamlOption),onConfirmCancel:t[5]||(t[5]=e=>s.yamlOption=s.preYamlOption)},null,512)])]))}var g=a(3514),_=a.n(g),k=a(20246),w=a.n(k),C=a(35664),V=a(52946),A=a(96858),E=a(25577),P=a(10006),B=a(55544),x=a(4364),R={name:"Values",props:{mode:{type:String,default:i.YQ},chartValues:{type:Object,default:()=>{}},value:{type:Object,required:!0}},components:{ButtonGroup:A.A,Loading:p.A,ResourceCancelModal:E.A,Tabbed:P.A,YamlEditor:B.A},async created(){const e=this.generateYaml();this.currentYamlValues=e,this.originalYamlValues=e;try{await this.loadValuesComponent()}catch(t){x.error(`Error loading values component: ${t}`)}},data(){return{YAML_OPTIONS:m.Nv,currentYamlValues:"",originalYamlValues:"",showForm:!0,configValues:null,showQuestions:!0,showValuesComponent:!1,valuesComponent:null,preYamlOption:m.FU.FORM,yamlOption:m.FU.FORM,values:this.chartValues}},watch:{yamlOption(e,t){switch(e){case m.FU.FORM:this.showForm=!0;break;case m.FU.YAML:t===m.FU.FORM&&(this.currentYamlValues=this.generateYaml(),this.updateYamlValues()),this.showForm=!1;break}}},computed:{editorMode(){return B.j.EDIT_CODE},isCreate(){return this.mode===i.YQ},isEdit(){return this.mode===i.G5}},methods:{generateYaml(){const e=this.$store.getters["cluster/all"](C.yx),t=(0,V.mH)(e,this.value?.type,this.chartValues),a=t.split("\n"),o=a.filter((e=>!e.includes("Error loading schema for array"))),r=o.join("\n");return r},async loadValuesComponent(){if(this.value.haveComponent("kubewarden/policy-server")){const e=this.value.importComponent("kubewarden/policy-server");this.valuesComponent=(0,o.markRaw)((0,o.defineAsyncComponent)(e)),this.showValuesComponent=!0}},tabChanged(){window.scrollTop=0},updateYamlValues(){if(!_()(this.currentYamlValues)){const e=w().load(this.currentYamlValues);e&&n()(this.chartValues,e)}},handleValidationPassed(e){this.$emit("validation-passed",e)}}},N=(a(15226),a(47433));const O=(0,N.A)(R,[["render",b],["__scopeId","data-v-228d5d9f"]]);var M=O,S={components:{Banner:u.l,CruResource:d.A,Loading:p.A,Values:M},mixins:[c.A],props:{mode:{type:String,default:i.G5},realMode:{type:String,default:i.G5},value:{type:Object,required:!0}},async fetch(){const e=this.$store.getters["cluster/schemaFor"](m.$v.POLICY_SERVER);await e.fetchResourceFields()},data(){return{chartValues:this.value}},created(){this.isCreate&&n()(this.chartValues,structuredClone(h.DEFAULT_POLICY_SERVER))},computed:{isCreate(){return this.realMode===i.YQ},hasErrors(){return this.errors?.length&&Array.isArray(this.errors)},validationPassed(){return!!this.chartValues?.metadata?.name}},methods:{closeError(e){const t=this.errors.filter(((t,a)=>a!==e));this.errors=t},async finish(e){const t=this.chartValues?.spec?.securityContexts;t&&["pod","container"].forEach((e=>{const a=t[e]?.seccompProfile;a&&0===Object.keys(a).length&&delete t[e].seccompProfile}));try{await this.save(e)}catch(a){this.errors.push(a)}}}};const T=(0,N.A)(S,[["render",s]]);var I=T},2639:function(e,t,a){var o=a(79759);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var r=a(74825).A;r("0b4a3990",o,!0,{sourceMap:!1,shadowMode:!1})},6685:function(e,t,a){var o=a(14717);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var r=a(74825).A;r("3880525e",o,!0,{sourceMap:!1,shadowMode:!1})},8125:function(e,t,a){"use strict";a.r(t);var o=a(36758),r=a.n(o),s=a(40935),l=a.n(s),n=l()(r());n.push([e.id,".step__values__controls[data-v-7bf0db83]{display:flex;margin-bottom:15px}.step__values__controls[data-v-7bf0db83]>:not(:last-of-type){margin-right:10px}.step__values__content[data-v-7bf0db83],.step__values__controls--spacer[data-v-7bf0db83]{flex:1}.step__values__content[data-v-7bf0db83] .tab-container{overflow:auto}",""]),t["default"]=n},12378:function(e,t,a){"use strict";a.r(t);var o=a(36758),r=a.n(o),s=a(40935),l=a.n(s),n=l()(r());n.push([e.id,"[data-v-228d5d9f] .step-container{height:auto}.step__basic[data-v-228d5d9f]{display:flex;flex-direction:column;flex:1;overflow-x:hidden}.step__basic .spacer[data-v-228d5d9f]{line-height:2}.step__values__controls[data-v-228d5d9f]{display:flex;margin-bottom:15px}.step__values__controls[data-v-228d5d9f]>:not(:last-of-type){margin-right:10px}.step__values__content[data-v-228d5d9f],.step__values__controls--spacer[data-v-228d5d9f]{flex:1}.step__values__content[data-v-228d5d9f] .tab-container{overflow:auto}",""]),t["default"]=n},14717:function(e,t,a){"use strict";a.r(t);var o=a(36758),r=a.n(o),s=a(40935),l=a.n(s),n=l()(r());n.push([e.id,".content[data-v-4f77d707]{position:relative;z-index:1}.banner__title[data-v-4f77d707]{padding-top:10px;margin-bottom:10px;border-bottom:1px solid var(--border);min-height:60px}.banner__readme-button[data-v-4f77d707]{padding:0 7px 0 0}",""]),t["default"]=n},15226:function(e,t,a){var o=a(12378);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var r=a(74825).A;r("26436fd6",o,!0,{sourceMap:!1,shadowMode:!1})},21232:function(e,t,a){"use strict";a.r(t);var o=a(36758),r=a.n(o),s=a(40935),l=a.n(s),n=l()(r());n.push([e.id,"[data-v-1ca77c0e] .header{display:none}[data-v-1ca77c0e] .controls-row{position:sticky;width:auto}[data-v-1ca77c0e] .controls-row .controls-steps{display:flex}[data-v-1ca77c0e] .custom{min-height:110px}[data-v-1ca77c0e] .subtype{height:110px;margin:10px;position:relative;border-radius:calc(var(--border-radius)*1.5);border:1px solid var(--border);text-decoration:none!important;color:var(--body-text)!important}[data-v-1ca77c0e] .subtype:hover:not(.disabled){box-shadow:0 0 30px var(--shadow);transition:box-shadow .1s ease-in-out;cursor:pointer;text-decoration:none!important}[data-v-1ca77c0e] .subtype .subtype__metadata{padding:10px}[data-v-1ca77c0e] .subtype .subtype__metadata__description,[data-v-1ca77c0e] .subtype .subtype__metadata__label{padding-right:20px}[data-v-1ca77c0e] .subtype .subtype__badge{position:absolute;right:0;top:0;padding:4px 5px;border-bottom-left-radius:var(--border-radius)}[data-v-1ca77c0e] .subtype .subtype__badge label{font-size:12px;line-height:12px;text-align:center;display:block;white-space:no-wrap;text-overflow:ellipsis;color:var(--app-rancher-accent-text);margin:0}[data-v-1ca77c0e] .subtype .subtype__label{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:4px;line-height:normal}[data-v-1ca77c0e] .subtype .subtype__description{margin-right:10px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;line-clamp:3;overflow:hidden;text-overflow:ellipsis;color:var(--input-label)}[data-v-1ca77c0e] .footer-error{margin-top:15px}.wizard[data-v-1ca77c0e]{position:relative;height:100%;z-index:1}.banner__title[data-v-1ca77c0e]{padding-top:10px;margin-bottom:10px;border-bottom:1px solid var(--border);min-height:60px}.banner__readme-button[data-v-1ca77c0e]{padding:0 7px 0 0}",""]),t["default"]=n},21426:function(e,t,a){"use strict";a.d(t,{k:function(){return n}});var o=a(3514),r=a.n(o),s=a(41580),l=a.n(s);function n(e){return Object.keys(e).forEach((t=>{const a=e[t];void 0===a||null===a||""===a||Array.isArray(a)&&!a.length?delete e[t]:l()(a)&&(n(a),r()(a)&&delete e[t])})),r()(e)?null:e}},24509:function(e,t,a){var o=a(8125);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var r=a(74825).A;r("3e4b6f00",o,!0,{sourceMap:!1,shadowMode:!1})},24964:function(e,t,a){"use strict";a.d(t,{A:function(){return se}});var o=a(9274);const r={key:1},s={class:"mb-10"},l={class:"banner__title"},n={class:"banner__short-description"},i={key:1,class:"mb-10"};function c(e,t,a,c,u,d){const p=(0,o.resolveComponent)("Loading"),h=(0,o.resolveComponent)("AsyncButton"),m=(0,o.resolveComponent)("Banner"),f=(0,o.resolveComponent)("PolicyTable"),v=(0,o.resolveComponent)("Values"),y=(0,o.resolveComponent)("Wizard"),b=(0,o.resolveComponent)("PolicyReadmePanel"),g=(0,o.resolveDirective)("clean-html");return u.isLoading?((0,o.openBlock)(),(0,o.createBlock)(p,{key:0,mode:"relative"})):((0,o.openBlock)(),(0,o.createElementBlock)("div",r,[d.hideOfficialRepoBanner?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(m,{key:0,"data-testid":"kw-policy-add-official-repo-banner",class:"type-banner mb-20 mt-0",color:"warning",closable:!0,onClose:t[0]||(t[0]=e=>d.closeBanner("updateHideBannerOfficialRepo"))},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",null,[(0,o.withDirectives)((0,o.createElementVNode)("p",s,null,512),[[g,e.t("kubewarden.policies.noOfficialPolicies",{},!0)]]),(0,o.createVNode)(h,{mode:"kubewardenPolicyCatalog",onClick:d.addRepository},null,8,["onClick"])])])),_:1})),d.hideRepoBanner?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(m,{key:1,"data-testid":"kw-policy-add-repo-banner",class:"type-banner mb-20 mt-0",color:"warning",closable:!0,onClose:t[1]||(t[1]=e=>d.closeBanner("updateHideBannerPolicyRepo"))},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("p",null,(0,o.toDisplayString)(e.t("kubewarden.policies.noPolicyRepo")),1)])),_:1})),d.hideAirgapBanner?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(m,{key:2,"data-testid":"kw-policy-create-ag-banner",class:"type-banner mb-20 mt-0",color:"warning",closable:!0,label:e.t("kubewarden.policies.airgap.banner"),onClose:t[2]||(t[2]=e=>d.closeBanner("updateHideBannerAirgapPolicy"))},null,8,["label"])),a.value?((0,o.openBlock)(),(0,o.createBlock)(y,{key:3,ref:"wizard",value:a.value,"data-testid":"kw-policy-create-wizard",errors:e.errors,steps:d.steps,"show-banner":!1,"edit-first-step":!0,class:"wizard",onNext:d.reset,onCancel:d.done,onFinish:d.finish},{policies:(0,o.withCtx)((()=>[(0,o.createVNode)(f,{"data-testid":"kw-policy-create-table",mode:a.mode,charts:d.latestPolicyChartsVersion,onSelectPolicy:t[3]||(t[3]=e=>d.selectPolicy(e))},null,8,["mode","charts"])])),values:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",l,[(0,o.createElementVNode)("h2",null,(0,o.toDisplayString)(u.bannerTitle),1),d.customPolicy?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:0},[(0,o.createElementVNode)("p",n,(0,o.toDisplayString)(u.shortDescription),1),u.selectedPolicyDetails&&(u.selectedPolicyDetails?.readme||e.selectPolicyDetails?.appreadme)&&!u.errorFetchingPolicy?((0,o.openBlock)(),(0,o.createElementBlock)("button",{key:0,class:"btn btn-sm role-link banner__readme-button",onClick:t[4]||(t[4]=(...e)=>d.showReadme&&d.showReadme(...e))},(0,o.toDisplayString)(e.t("kubewarden.policyConfig.description.showReadme")),1)):((0,o.openBlock)(),(0,o.createElementBlock)("div",i))],64))]),(0,o.createVNode)(v,{value:a.value,"chart-values":u.chartValues,"yaml-values":u.yamlValues,mode:a.mode,"custom-policy":d.customPolicy,"error-fetching-policy":u.errorFetchingPolicy,onEditor:t[5]||(t[5]=e=>u.yamlOption=e),onUpdateYamlValues:t[6]||(t[6]=e=>u.yamlValues=e)},null,8,["value","chart-values","yaml-values","mode","custom-policy","error-fetching-policy"])])),finish:(0,o.withCtx)((()=>[(0,o.createVNode)(h,{"data-testid":"kw-policy-create-finish-button",disabled:!d.canFinish,mode:"finish",class:"ml-20",onClick:d.finish},null,8,["disabled","onClick"])])),_:1},8,["value","errors","steps","onNext","onCancel","onFinish"])):(0,o.createCommentVNode)("",!0),!u.selectedPolicyDetails||!u.selectedPolicyDetails?.readme&&!e.selectPolicyDetails?.appreadme||d.customPolicy||u.errorFetchingPolicy?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(b,{key:4,ref:"readmePanel","policy-chart-details":u.selectedPolicyDetails},null,8,["policy-chart-details"]))]))}var u=a(20246),d=a.n(u),p=a(3514),h=a.n(p),m=a(46343),f=a.n(m),v=a(82451),y=a.n(v),b=a(65359),g=a(14220),_=a(35664),k=a(91825),w=a(52946),C=a(76978),V=a(9980),A=a(88771),E=a(84409),P=a(5508),B=a(56505),x=a(63875),R=a(21426);function N(e){return e.replace(/\/$/,"")}var O=a(78920),M=a(37069),S=a(2722),T=a.n(S),I=a(91462),F=a(92043),Y=a(88697),D=a(94160),L=a(42200),$=a(65165);function U(e){const t=[],a=e?.flatMap((e=>{const t=e?.annotations?.[B.XD.RESOURCES]??e?.annotations?.[B.qs.RESOURCES];if(t)return t}));return a?.flatMap((e=>{if(e){const a=e.split(",");a.length>1?a.forEach((e=>t.push(e.trim()))):t.push(e)}return[]}))?.sort(),t&&0!==t?.length?[...new Set(t.filter(Boolean))]:[]}function q(e,t){if(e){const a=e.annotations?.["kubewarden/resources"]?.split(",");let o=!1;if(a)for(const e of a)o=t?.some((t=>t?.attributes?.kind===e&&(!1===t?.attributes?.namespaced||void 0)));return o}return!1}var j=a(82964),G=(0,o.defineComponent)({__name:"SortableTableWrapper",props:{rows:{},headers:{},tableActions:{type:Boolean},rowActions:{type:Boolean},keyField:{},defaultSortBy:{},paging:{type:Boolean},search:{type:Boolean},useQueryParamsForSimpleFiltering:{type:Boolean}},emits:["selectRow"],setup(e,{emit:t}){const a=t,r=(0,o.ref)(),s=(0,o.ref)([]),l=()=>{(0,o.nextTick)((()=>{const e=r.value?.$el?.querySelector("table");e&&(n(),e.querySelectorAll("tbody tr").forEach(((e,t)=>{const o=()=>{const e=(r.value?.$props).rows||[];a("selectRow",e[t])};e.addEventListener("click",o),s.value.push({row:e,listener:o})})))}))},n=()=>{s.value.forEach((({row:e,listener:t})=>{e.removeEventListener("click",t)})),s.value=[]};return(0,o.watch)((()=>r.value?.$props.rows),(()=>{l()})),(0,o.onMounted)((()=>{l()})),(0,o.onBeforeUnmount)((()=>{n()})),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createVNode)((0,o.unref)(j.A),{ref_key:"sortableTable",ref:r,rows:e.rows,headers:e.headers,"table-actions":e.tableActions,"row-actions":e.rowActions,"key-field":e.keyField,"default-sort-by":e.defaultSortBy,paging:e.paging,search:e.search,"use-query-params-for-simple-filtering":e.useQueryParamsForSimpleFiltering},null,8,["rows","headers","table-actions","row-actions","key-field","default-sort-by","paging","search","use-query-params-for-simple-filtering"])]))}});const z=G;var Q=z;const K={class:"policy-table-container"},H={class:"filter"},W={class:"policy-table-actions"};var X=(0,o.defineComponent)({__name:"PolicyTable",props:{mode:{},charts:{}},emits:["selectPolicy"],setup(e,{emit:t}){const a=e,r=t,s=(0,o.inject)("chartType",""),l=(0,b.Pj)(),n=(0,M.lq)(),i=l.getters["i18n/t"],c=(0,o.ref)(n?.query?.[g.XJ]||""),u=(0,o.ref)(n?.query?.[g.os]||""),d=(0,o.ref)([i("kubewarden.utils.attributes.optionLabels.all")]),p=(0,o.ref)(!0),h=(0,o.computed)((()=>l.getters["cluster/all"](_.yx))),m=(0,o.computed)((()=>l.getters["prefs/get"](I.kJ))),f=(0,o.computed)({get(){return d.value},set(e){const t=i("kubewarden.utils.attributes.optionLabels.all");let a=[...e];a.length||(a=[t]),a.length>1&&a.includes(t)&&(a=a.filter((e=>e!==t))),d.value=a}}),v=(0,o.computed)((()=>a.charts?.filter((e=>{const t=V(e);return!(!m.value&&t)&&(s!==B.$v.ADMISSION_POLICY||!q(e,h.value))}))||[])),y=(0,o.computed)((()=>{const e=m.value,t=u.value,o=p.value,r=(t||"").split(/\s*[, ]\s*/).map((e=>(0,F.OF)(e,!1))).filter((e=>e));return a.charts.filter((t=>{if(s===B.$v.ADMISSION_POLICY&&q(t,h.value))return!1;const a=V(t);if(!e&&a)return!1;if(o&&!t.official)return!1;if(r.length){const e=P(t),a=x(t),o=t.description||"",s=r.every((t=>e&&e.match(t)||o&&o.match(t)||a.some((e=>e.match(t)))));if(!s)return!1}if(d.value.length){if(d.value.includes(i("kubewarden.utils.attributes.optionLabels.all")))return!0;const e=d.value.some((e=>{const a=w.value.includes(e);if(a)return"Mutation"===e?N(t):"Context Aware"===e&&O(t);{const a=R(t);return a?.includes(e)}}));if(!e)return!1}return!0})).sort(((e,t)=>e.name.localeCompare(t.name)))})),k=(0,o.computed)((()=>{const e=[];return C.value?.length&&e.push({kind:"group",label:i("kubewarden.utils.attributes.optionLabels.resource")},...C.value),w.value.length&&e.push({kind:"group",label:i("kubewarden.utils.attributes.optionLabels.features")},...w.value),e.length&&e.unshift(i("kubewarden.utils.attributes.optionLabels.all"),{kind:"divider",label:"divider"}),e})),w=(0,o.computed)((()=>{const e=[];for(const t of v.value)"true"===t?.annotations?.["kubewarden/mutation"]&&e.push("Mutation"),t?.annotations?.["kubewarden/contextAwareResources"]&&e.push("Context Aware");return[...new Set(e.filter(Boolean))]})),C=(0,o.computed)((()=>U(v.value)));function V(e){const t=T().prerelease(e.version);return t&&"deprecated-api-versions"===e.name?!!t.includes("rc"):!!t}function A(){c.value="",d.value=[i("kubewarden.utils.attributes.optionLabels.all")],u.value=""}function E(e,t){return e.annotations?.[B.XD[t]]??e.annotations?.[B.qs[t]]}function P(e){return E(e,"DISPLAY_NAME")||e.name}function x(e){const t=E(e,"KEYWORDS")||"",a=t?t.split(","):[];return[...e.keywords||[],...a].filter(Boolean)}function R(e){return E(e,"RESOURCES")}function N(e){return"true"===e.annotations?.[B.XD.MUTATION]}function O(e){return"true"===e.annotations?.[B.XD.CONTEXT_AWARE_RESOURCES]}return(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)("div",K,[(0,o.createElementVNode)("div",H,[k.value.length?((0,o.openBlock)(),(0,o.createBlock)((0,o.unref)(Y.A),{key:0,value:f.value,"onUpdate:value":t[0]||(t[0]=e=>f.value=e),"data-testid":"kw-table-filter-source",clearable:!0,taggable:!0,mode:a.mode,multiple:!0,class:"filter__attributes",label:(0,o.unref)(i)("kubewarden.utils.attributes.label"),options:k.value},null,8,["value","mode","label","options"])):(0,o.createCommentVNode)("",!0),(0,o.createVNode)((0,o.unref)(D.o),{ref:"searchQueryInput",value:u.value,"onUpdate:value":t[1]||(t[1]=e=>u.value=e),"data-testid":"kw-table-filter-search",mode:a.mode,class:"input-sm filter__search",label:(0,o.unref)(i)("kubewarden.utils.search"),placeholder:(0,o.unref)(i)("kubewarden.generic.name")},null,8,["value","mode","label","placeholder"]),(0,o.createElementVNode)("button",{"data-testid":"kw-table-filter-refresh",class:"btn role-tertiary filter__reset",type:"button",onClick:A},[(0,o.createElementVNode)("p",null,(0,o.toDisplayString)((0,o.unref)(i)("kubewarden.utils.resetFilter")),1)])]),(0,o.createElementVNode)("div",W,[(0,o.createVNode)((0,o.unref)(L.S),{value:p.value,"onUpdate:value":t[2]||(t[2]=e=>p.value=e),label:(0,o.unref)(i)("kubewarden.utils.official.label"),"data-testid":"kw-table-filter-official"},null,8,["value","label"]),(0,o.createElementVNode)("button",{"data-testid":"kw-table-custom-buttom",class:"btn role-tertiary",type:"button",onClick:t[3]||(t[3]=e=>r("selectPolicy","custom"))},[(0,o.createElementVNode)("p",null,(0,o.toDisplayString)((0,o.unref)(i)("kubewarden.utils.custom.create")),1)])]),(0,o.createVNode)((0,o.unref)(Q),{rows:y.value,headers:(0,o.unref)($.BM),"table-actions":!1,"row-actions":!1,"key-field":"digest","default-sort-by":"name",paging:!0,search:!1,onSelectRow:t[4]||(t[4]=e=>r("selectPolicy",e))},null,8,["rows","headers"])]))}}),Z=(a(2639),a(47433));const J=(0,Z.A)(X,[["__scopeId","data-v-2ce15ea6"]]);var ee=J,te=a(43874),ae=a(4364),oe={name:"Create",props:{mode:{type:String,default:g.YQ},value:{type:Object,default:()=>({})}},components:{AsyncButton:A.A,Banner:V.l,Loading:E.A,Wizard:P.A,PolicyTable:ee,PolicyReadmePanel:O.A,Values:te.A},inject:["chartType"],mixins:[k.A],async created(){this.isLoading=!0;const e=this.$store.getters["catalog/repos"]?.length>0;!e&&this.$store.getters["cluster/canList"](_.W8.CLUSTER_REPO)&&await this.$store.dispatch("cluster/findAll",{type:_.W8.CLUSTER_REPO});const t=this.$store.getters["catalog/charts"]?.length>0;t||await this.$store.dispatch("catalog/refresh"),this.value.apiVersion=`${this.schema?.attributes?.group}.${this.schema?.attributes?.version}`,this.value.kind=this.schema?.attributes?.kind,this.isLoading=!1},data(){const e=[B.jI.POLICY_CATALOG,B.jI.POLICY_CATALOG_REPO,B.jI.POLICY_CATALOG_REPO_GIT];return{OFFICIAL_REPOS:e,isLoading:!1,bannerTitle:null,shortDescription:null,loadingPackages:!1,packages:null,repository:null,selectedPolicyChart:null,selectedPolicyDetails:null,typeModule:null,version:null,errorFetchingPolicy:!1,chartValues:{policy:{},questions:{}},yamlValues:"",hasCustomPolicy:!1,yamlOption:B.FU.FORM,finishAttempts:0,stepPolicies:{hidden:!1,name:"policies",label:"Policies",ready:!1,showSteps:!1,weight:99},stepValues:{name:"values",label:"Values",ready:!0,showSteps:!1,weight:98}}},computed:{...(0,b.L8)({charts:"catalog/charts",repos:"catalog/repos"}),isAirgap(){return this.$store.getters["kubewarden/airGapped"]},isCreate(){return this.realMode===g.YQ},isSelected(){return!!this.selectedPolicyChart},customPolicy(){return"custom"===this.selectedPolicyChart},canFinish(){return this.yamlOption===B.FU.YAML||!!this.chartValues?.policy?.spec?.module&&this.hasRequired},systemDefaultRegistry(){return this.$store.getters["management/byId"](_.Mc.SETTING,"system-default-registry")},hasRequired(){if(!h()(this.chartValues?.policy)&&this.chartValues.policy.spec){const{rules:e,settings:t}=this.chartValues.policy.spec,a=["apiVersions","operations","resources"],o=this.acceptedValues(e,a),r=this.chartValues.policy.metadata.name,s=this.chartValues?.questions?.questions?.map((e=>{if(e.required)return e.variable})).filter(Boolean),l=this.acceptedValues(t,s);if(r&&!h()(o)&&(h()(s)||!h()(l)))return!0}return!1},hideOfficialRepoBanner(){return!!this.officialKubewardenRepo||this.$store.getters["kubewarden/hideBannerOfficialRepo"]},hideRepoBanner(){return!this.hideOfficialRepoBanner||this.policiesCharts.length||this.$store.getters["kubewarden/hideBannerPolicyRepo"]},hideAirgapBanner(){return!this.isAirgap||this.$store.getters["kubewarden/hideBannerAirgapPolicy"]},steps(){const e=[];return e.push(this.stepPolicies,this.stepValues),e.sort(((e,t)=>t.weight-e.weight))},policiesCharts(){return this.charts?.filter((e=>"kubewarden-policy"===e.chartType))},latestPolicyChartsVersion(){return this.policiesCharts?.map((e=>{const t=e.versions[0],a=this.$store.getters["catalog/repo"]({repoType:t.repoType,repoName:t.repoName}),o=N(a?.spec?.url||"");return t.official=this.OFFICIAL_REPOS.includes(o),t}))},reposByName(){return this.repos.reduce(((e,t)=>(e[t.metadata.name]=t,e)),{})},reposByUrl(){return this.repos.reduce(((e,t)=>{const a=t.spec.url||t.spec.gitRepo,o=a?N(a):a;return o&&(e[o]=t),e}),{})},officialKubewardenRepo(){for(const e of this.OFFICIAL_REPOS)if(this.reposByUrl[e])return this.reposByUrl[e];return null}},methods:{async addRepository(e){try{const a=await this.$store.dispatch("cluster/create",{type:_.W8.CLUSTER_REPO,metadata:{name:"kubewarden-policy-catalog"},spec:{url:B.jI.POLICY_CATALOG}});try{await a.save()}catch(t){return(0,x.q)({error:t,store:this.$store}),void e(!1)}this.officialKubewardenRepo||await this.$store.dispatch("catalog/refresh")}catch(t){(0,x.q)({error:t,store:this.$store}),e(!1)}},acceptedValues(e,t){if(h()(t))return null;let a;return a=Array.isArray(e)?e.find((e=>this.checkProperties(e,t))):this.checkProperties(e,t),a},checkProperties(e,t){const a=[];if(!h()(t)){for(const o of t.values())h()(e[o])||a.push(o);if(t&&f()(a,t))return e}return null},async closeBanner(e,t=0){const a=await this.$store.dispatch(`kubewarden/${e}`,!0);0===t&&"error"===a?.type&&500===a?.status&&await this.close(t+1)},async createNamespace(e){const t=this.$store.getters["cluster/all"](_.CU),a={type:_.CU,metadata:{name:e},disableOpenApiValidation:!1},o=t?.find((t=>t?.metadata?.name===e));if(!o){const e=await this.$store.dispatch("cluster/create",a);try{await e.save()}catch(r){this.errors.push(r)}}},done(){this.$router.replace({name:"c-cluster-product-resource",params:{cluster:this.$route.params.cluster,product:B.bp,resource:this.schema?.id}})},async finish(e){try{let t;t=this.yamlOption===B.FU.YAML?d().load(this.yamlValues):this.chartValues?.policy?this.chartValues.policy:d().load(this.yamlValues),(0,R.k)(t),this.finishAttempts>0?(Object.keys(this.value.spec).forEach((e=>{e in t.spec||this.$delete(this.value.spec,e)})),Object.keys(t.spec).forEach((e=>{this.value.spec.key=t.spec[e]}))):y()(this.value,t),this.chartType===B.$v.ADMISSION_POLICY&&this.chartValues?.isNamespaceNew&&await this.createNamespace(this.value?.metadata?.namespace),await this.attemptSave(e)}catch(t){ae.error("Error creating policy",t)}},async attemptSave(e){if(await this.save(e),this.errors&&this.errors.length>0){const e=new Error("Save operation failed");throw this.finishAttempts++,e}},parseObj(e){if(!e)return null;const t=JSON.parse(JSON.stringify(e));return d().load(t)},async policyQuestions(){const e=structuredClone(B.zj);if(this.customPolicy){const t={spec:{contextAwareResources:[]}},a=y()({},e,t);return(0,C.hZ)(this.chartValues,"policy",a),void(this.yamlValues=(0,w.Kq)(a))}this.value.metadata.annotations=this.value.metadata.annotations||{},this.value.metadata.annotations[B.cT.CHART_KEY]=this.selectedPolicyChart.key,this.value.metadata.annotations[B.cT.CHART_NAME]=this.selectedPolicyChart.name,this.value.metadata.annotations[B.cT.CHART_VERSION]=this.selectedPolicyChart.version;try{this.selectedPolicyDetails=await this.$store.dispatch("catalog/getVersionInfo",{repoType:this.selectedPolicyChart.repoType,repoName:this.selectedPolicyChart.repoName,chartName:this.selectedPolicyChart.name,versionName:this.selectedPolicyChart.version});const t=this.selectedPolicyDetails?.questions,a=(0,o.toRaw)(this.selectedPolicyDetails?.chart?.annotations);if(!a)throw new Error("Policy annotations are missing");let r=a[B.au.REGISTRY],s=`${a[B.au.REPOSITORY]}:${a[B.au.TAG]}`;this.systemDefaultRegistry?.value&&this.systemDefaultRegistry.value!==this.systemDefaultRegistry.default&&(r=this.systemDefaultRegistry.value),r&&(s=`${r}/${s}`);const l={apiVersion:this.value.apiVersion,kind:this.value.kind,metadata:{...this.value.metadata},spec:{module:s,mode:"monitor",mutating:"true"===a[B.au.MUTATING]||!1,rules:this.parseObj(a[B.au.RULES])||[]}};this.chartType===B.$v.CLUSTER_ADMISSION_POLICY&&Object.assign(l.spec,{contextAwareResources:this.parseObj(a[B.au.CONTEXT_AWARE_RESOURCES])||[]}),y()(e,l),(0,C.hZ)(this.chartValues,"policy",e),this.yamlValues=(0,w.Kq)(this.chartValues.policy),t&&(0,C.hZ)(this.chartValues,"questions",t),this.shortDescription=this.selectedPolicyChart?.description}catch(t){ae.warn("Error fetching policy questions. Using default policy scaffold. Details:",t),this.errorFetchingPolicy=!0,this.bannerTitle="Policy Details Unavailable",this.shortDescription=`There was an issue retrieving the policy details. The default configuration will be used. (Error: ${t.message||"Unknown error"})`,(0,C.hZ)(this.chartValues,"policy",e),this.yamlValues=(0,w.Kq)(e)}},reset(e){this.$nextTick((()=>{if(e.step?.name===this.stepPolicies.name){const e=["errors","bannerTitle","shortDescription","selectedPolicyChart","selectedPolicyDetails","typeModule","version","hasCustomPolicy"];e.forEach((e=>{this[e]=null})),this.stepPolicies.ready=!1,this.stepValues.hidden=!1,this.chartValues={policy:{},questions:{}},this.yamlOption=B.FU.FORM,this.yamlValues="",this.$router.replace({path:this.$route.path,query:this.$route.query,hash:""})}}))},async selectPolicy(e){this.selectedPolicyChart=e,this.customPolicy?this.hasCustomPolicy=!0:this.hasCustomPolicy=!1,await this.policyQuestions(),this.stepPolicies.ready=!0,this.$refs.wizard.next(),this.bannerTitle=this.customPolicy?"Custom Policy":e?.annotations?.[B.XD.DISPLAY_NAME]||e?.name},showReadme(){this.$refs.readmePanel?.show()}}};a(32752);const re=(0,Z.A)(oe,[["render",c],["__scopeId","data-v-1ca77c0e"]]);var se=re},25458:function(e,t,a){var o=a(882);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var r=a(74825).A;r("45ae5902",o,!0,{sourceMap:!1,shadowMode:!1})},32752:function(e,t,a){var o=a(21232);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var r=a(74825).A;r("0f6eda8a",o,!0,{sourceMap:!1,shadowMode:!1})},34856:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var o=a(9274);function r(e,t,a,r,s,l){const n=(0,o.resolveComponent)("Create"),i=(0,o.resolveComponent)("Config"),c=(0,o.resolveComponent)("CruResource");return l.isCreate?((0,o.openBlock)(),(0,o.createBlock)(n,{key:0,value:a.value,mode:a.mode},null,8,["value","mode"])):((0,o.openBlock)(),(0,o.createBlock)(c,{key:1,errors:e.errors,resource:a.value,mode:a.realMode,"can-yaml":!1,onFinish:l.finish},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(i,{value:a.value,mode:a.realMode,onUpdateYamlValues:l.updateYamlValuesFromEdit},null,8,["value","mode","onUpdateYamlValues"])])),_:1},8,["errors","resource","mode","onFinish"]))}var s=a(14220),l=a(91825),n=a(20246),i=a.n(n),c=a(63875),u=a(21426),d=a(46037),p=a(90458),h=a(24964),m={name:"ClusterAdmissionPolicy",props:{value:{type:Object,required:!0},mode:{type:String,default:s.G5},realMode:{type:String,default:s.G5}},components:{CruResource:d.A,Config:p.A,Create:h.A},mixins:[l.A],provide(){return{chartType:this.value.type,realMode:this.realMode}},computed:{isCreate(){return this.realMode===s.YQ},isClone(){return this.realMode===s.dT},schema(){return this.$store.getters["cluster/schemaFor"](this.value.type)}},methods:{async finish(e){try{(0,u.k)(this.value),this.isClone&&this.value.isKubewardenDefaultPolicy&&"kubewarden-defaults"===this.value?.metadata?.labels?.["app.kubernetes.io/name"]&&delete this.value?.metadata?.labels?.["app.kubernetes.io/name"],await this.save(e,this.schema?.linkFor("collection")||"")}catch(t){(0,c.q)({error:t,store:this.$store})}},updateYamlValuesFromEdit(e){const t=i().load(e);(0,u.k)(t),Object.keys(this.value).forEach((e=>{Object.prototype.hasOwnProperty.call(t,e)||delete this.value[e]})),Object.assign(this.value,t),this.$emit("input",this.value)}}},f=(a(76081),a(47433));const v=(0,f.A)(m,[["render",r],["__scopeId","data-v-6e954f10"]]);var y=v},43874:function(e,t,a){"use strict";a.d(t,{A:function(){return w}});var o=a(9274),r=a(65359),s=a(14220),l=a(35664),n=a(52946),i=a(96858),c=a(84409),u=a(25577),d=a(10006),p=a(55544),h=a(56505),m=a(4364);const f={key:1},v={key:0,class:"step__values__controls"},y={class:"scroll__container"},b={class:"scroll__content"};var g=(0,o.defineComponent)({__name:"Values",props:{mode:{},chartValues:{},customPolicy:{type:Boolean},value:{},yamlValues:{},errorFetchingPolicy:{type:Boolean}},emits:["editor","updateYamlValues"],setup(e,{emit:t}){const a=e,g=(0,r.Pj)(),_=t,k=(0,o.ref)(!0),w=(0,o.ref)(""),C=(0,o.ref)(""),V=(0,o.ref)(!0),A=(0,o.ref)(null),E=(0,o.ref)(h.FU.FORM),P=(0,o.ref)(h.FU.FORM),B=(0,o.ref)(null),x=(0,o.computed)((()=>p.j.EDIT_CODE)),R=(0,o.computed)((()=>a.mode===s.YQ)),N=(0,o.computed)((()=>a.mode===s.G5));function O(){const e=g.getters["cluster/all"](l.yx),t=(0,o.toRaw)(a.chartValues.policy),r=t?structuredClone(t):a.value;a.yamlValues?.length?w.value=a.yamlValues:w.value=(0,n.mH)(e,a.value?.type,r)}function M(){if(a.value?.haveComponent("kubewarden/admission")){const e=a.value.importComponent("kubewarden/admission");A.value=(0,o.markRaw)((0,o.defineAsyncComponent)(e))}}function S(){window.scrollTo(0,0)}function T(){_("updateYamlValues",w.value)}return(0,o.watch)(P,((e,t)=>{switch(e){case h.FU.FORM:V.value=!0,_("editor",e);break;case h.FU.YAML:t===h.FU.FORM&&(w.value=(0,n.Kq)(a.chartValues.policy),T()),V.value=!1,_("editor",e);break}})),(0,o.onMounted)((async()=>{try{B.value=g.getters["catalog/version"]({repoType:"cluster",repoName:"kubewarden",chartName:h.j6.CONTROLLER}),M()}catch(e){m.warn(`Unable to fetch Version: ${e}`)}O(),a.mode===s.YQ&&"ClusterAdmissionPolicy"===a.chartValues?.policy?.kind&&(a.chartValues?.policy?.spec?.namespaceSelector||(a.chartValues.policy.spec.namespaceSelector={}),a.chartValues.policy.spec.namespaceSelector.matchExpressions=[h.hQ]),k.value=!1})),(e,t)=>k.value?((0,o.openBlock)(),(0,o.createBlock)((0,o.unref)(c.A),{key:0,mode:"relative"})):((0,o.openBlock)(),(0,o.createElementBlock)("div",f,[R.value||N.value?((0,o.openBlock)(),(0,o.createElementBlock)("div",v,[(0,o.createVNode)((0,o.unref)(i.A),{value:P.value,"onUpdate:value":t[0]||(t[0]=e=>P.value=e),"data-testid":"kw-policy-config-yaml-option",options:(0,o.unref)(h.Nv),"inactive-class":"bg-disabled btn-sm","active-class":"bg-primary btn-sm"},null,8,["value","options"])])):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",y,[(0,o.createElementVNode)("div",b,[V.value?((0,o.openBlock)(),(0,o.createBlock)((0,o.unref)(d.A),{key:0,ref:"tabs","side-tabs":!0,class:"step__values__content",onChanged:t[1]||(t[1]=e=>S())},{default:(0,o.withCtx)((()=>[A.value?((0,o.openBlock)(),(0,o.createBlock)((0,o.resolveDynamicComponent)(A.value),{key:0,value:e.chartValues,mode:e.mode,"custom-policy":e.customPolicy,"error-fetching-policy":e.errorFetchingPolicy},null,8,["value","mode","custom-policy","error-fetching-policy"])):(0,o.createCommentVNode)("",!0)])),_:1},512)):!R.value&&!N.value||V.value?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)((0,o.unref)(p.A),{key:1,ref:"yaml",value:w.value,"onUpdate:value":t[2]||(t[2]=e=>w.value=e),"data-testid":"kw-policy-config-yaml-editor",class:"step__values__content",scrolling:!0,"initial-yaml-values":C.value,"editor-mode":x.value,"hide-preview-buttons":!0,onOnChanges:T},null,8,["value","initial-yaml-values","editor-mode"])),(0,o.createVNode)((0,o.unref)(u.A),{ref:"cancelModal","data-testid":"kw-policy-config-yaml-cancel","is-cancel-modal":!1,"is-form":!0,onCancelCancel:t[3]||(t[3]=e=>E.value=P.value),onConfirmCancel:t[4]||(t[4]=e=>P.value=E.value)},null,512)])])]))}}),_=(a(24509),a(47433));const k=(0,_.A)(g,[["__scopeId","data-v-7bf0db83"]]);var w=k},44146:function(e,t,a){"use strict";a.r(t);var o=a(36758),r=a.n(o),s=a(40935),l=a.n(s),n=l()(r());n.push([e.id,"[data-v-5f854ef2] .btn-sm{padding:0 7px 0 0}.policy-info-panel[data-v-5f854ef2]{position:fixed;top:0;left:0;z-index:2;overflow-y:auto;--banner-top-offset:0}.policy-info-panel .glass[data-v-5f854ef2]{left:0;width:100%;opacity:0}.policy-info-panel .glass[data-v-5f854ef2],.policy-info-panel .slideIn[data-v-5f854ef2]{position:fixed;top:calc(54px + var(--banner-top-offset));height:calc(100% - 54px - var(--banner-top-offset));overflow-y:auto}.policy-info-panel .slideIn[data-v-5f854ef2]{border-left:var(--header-border-size) solid var(--header-border);right:-45%;background-color:var(--topmenu-bg);width:45%;display:flex;flex-direction:column;box-shadow:-3px 0 5px rgba(0,0,0,.1);padding:10px;transition:right .5s ease}.policy-info-panel .slideIn__header[data-v-5f854ef2]{text-transform:inherit}.policy-info-panel .slideIn .policy-info-content[data-v-5f854ef2]{display:flex;flex-direction:column;overflow-y:auto}.policy-info-panel .slideIn h3[data-v-5f854ef2]{font-size:14px;margin:0;opacity:.7;text-transform:uppercase}.policy-info-panel .slideIn .policy-header[data-v-5f854ef2]{border-bottom:1px solid var(--border);display:flex;align-items:center}.policy-info-panel .slideIn .policy-header .policy-title[data-v-5f854ef2]{flex:1}.policy-info-panel .slideIn__header[data-v-5f854ef2]{display:flex;align-items:center;justify-content:space-between}.policy-info-panel .slideIn__header__buttons[data-v-5f854ef2]{display:flex;align-items:center}.policy-info-panel .slideIn__header__button[data-v-5f854ef2]{cursor:pointer;display:flex;align-items:center;justify-content:center}.policy-info-panel .slideIn__header__button>i[data-v-5f854ef2]{font-size:20px;opacity:.5}.policy-info-panel .slideIn__header__button[data-v-5f854ef2]:hover{background-color:var(--wm-closer-hover-bg)}.policy-info-panel .slideIn__show[data-v-5f854ef2]{right:0}",""]),t["default"]=n},46962:function(e,t,a){var o=a(44146);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var r=a(74825).A;r("5a319f52",o,!0,{sourceMap:!1,shadowMode:!1})},49543:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var o=a(9274);function r(e,t,a,r,s,l){const n=(0,o.resolveComponent)("Create"),i=(0,o.resolveComponent)("Config"),c=(0,o.resolveComponent)("CruResource");return l.isCreate?((0,o.openBlock)(),(0,o.createBlock)(n,{key:0,value:a.value,mode:a.mode},null,8,["value","mode"])):((0,o.openBlock)(),(0,o.createBlock)(c,{key:1,errors:e.errors,resource:a.value,mode:a.realMode,"can-yaml":!1,onFinish:l.finish},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(i,{value:a.value,mode:a.realMode,onUpdateYamlValues:l.updateYamlValuesFromEdit},null,8,["value","mode","onUpdateYamlValues"])])),_:1},8,["errors","resource","mode","onFinish"]))}var s=a(20246),l=a.n(s),n=a(14220),i=a(91825),c=a(46037),u=a(21426),d=a(63875),p=a(90458),h=a(24964),m={name:"AdmissionPolicy",props:{value:{type:Object,required:!0},mode:{type:String,default:n.G5},realMode:{type:String,default:n.G5}},components:{CruResource:c.A,Config:p.A,Create:h.A},mixins:[i.A],provide(){return{chartType:this.value.type,realMode:this.realMode}},computed:{isCreate(){return this.realMode===n.YQ},isClone(){return this.realMode===n.dT},schema(){return this.$store.getters["cluster/schemaFor"](this.value.type)}},methods:{async finish(e){try{(0,u.k)(this.value),this.isClone&&this.value.isKubewardenDefaultPolicy&&"kubewarden-defaults"===this.value?.metadata?.labels?.["app.kubernetes.io/name"]&&delete this.value?.metadata?.labels?.["app.kubernetes.io/name"],await this.save(e,this.schema?.linkFor("collection")||"")}catch(t){(0,d.q)({error:t,store:this.$store})}},updateYamlValuesFromEdit(e){const t=l().load(e);(0,u.k)(t),Object.assign(this.value,t)}}},f=(a(25458),a(47433));const v=(0,f.A)(m,[["render",r],["__scopeId","data-v-788fd4b0"]]);var y=v},76081:function(e,t,a){var o=a(79505);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var r=a(74825).A;r("803a93b0",o,!0,{sourceMap:!1,shadowMode:!1})},78920:function(e,t,a){"use strict";a.d(t,{A:function(){return y}});var o=a(9274),r=a(65359),s=a(60724),l=a(56505);const n={class:"policy-info-panel",style:"--banner-top-offset: 0px"},i={class:"slideIn__header"},c={key:0,class:"policy-info-content"},u={class:"policy-header pb-10"},d={class:"slideIn__header__buttons"},p={class:"policy-title mt-20"},h={class:"policy-info-title"};var m=(0,o.defineComponent)({__name:"PolicyReadmePanel",props:{policyChartDetails:{}},setup(e,{expose:t}){const a=e,m=(0,r.Pj)(),f=(0,o.ref)(!1),v=m.getters["i18n/t"],y=(0,o.computed)((()=>{const{annotations:e}=a.policyChartDetails.chart;let t=a.policyChartDetails.chart.name;return e&&(t=e[l.XD.DISPLAY_NAME]??e[l.qs.DISPLAY_NAME]??t),t})),b=()=>{f.value=!0},g=()=>{f.value=!1};return t({show:b,hide:g}),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)("div",n,[f.value?((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:0,class:"glass","data-testid":"extension-details-bg",onClick:g})):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["slideIn",{hide:!1,slideIn__show:f.value}]),"data-testid":"extension-details"},[(0,o.createElementVNode)("div",i,[a.policyChartDetails?((0,o.openBlock)(),(0,o.createElementBlock)("div",c,[(0,o.createElementVNode)("div",u,[(0,o.createElementVNode)("div",d,[(0,o.createElementVNode)("button",{class:"btn btn-sm role-link",onClick:g},[(0,o.createElementVNode)("span",null,(0,o.toDisplayString)((0,o.unref)(v)("generic.close")),1),t[0]||(t[0]=(0,o.createElementVNode)("i",{class:"icon icon-chevron-right"},null,-1))])])]),(0,o.createElementVNode)("div",p,[(0,o.createElementVNode)("h2",h,(0,o.toDisplayString)(y.value),1)]),(0,o.createVNode)((0,o.unref)(s.A),{class:"mt-20","version-info":e.policyChartDetails},null,8,["version-info"])])):(0,o.createCommentVNode)("",!0)])],2)]))}}),f=(a(46962),a(47433));const v=(0,f.A)(m,[["__scopeId","data-v-5f854ef2"]]);var y=v},79505:function(e,t,a){"use strict";a.r(t);var o=a(36758),r=a.n(o),s=a(40935),l=a.n(s),n=l()(r());n.push([e.id,"[data-v-6e954f10] .cru__footer{z-index:1}",""]),t["default"]=n},79759:function(e,t,a){"use strict";a.r(t);var o=a(36758),r=a.n(o),s=a(40935),l=a.n(s),n=l()(r());n.push([e.id,'.policy-table-container[data-v-2ce15ea6]{display:flex;flex-direction:column;gap:1rem;padding:1rem}.policy-table-actions[data-v-2ce15ea6]{display:flex;justify-content:space-between;align-items:center}.filter[data-v-2ce15ea6]{width:100%;display:grid;grid-template-rows:1fr;grid-template-columns:repeat(2,1fr) .25fr;grid-template-areas:"attributes search reset";gap:1rem}.filter[data-v-2ce15ea6]>*{margin:.5rem 0}.filter__attributes[data-v-2ce15ea6]{grid-area:attributes}.filter__search[data-v-2ce15ea6]{grid-area:search}.filter__reset[data-v-2ce15ea6]{grid-area:reset}.filter__reset p[data-v-2ce15ea6]{line-height:1.5;white-space:wrap}[data-v-2ce15ea6] tr:hover{cursor:pointer}',""]),t["default"]=n},90458:function(e,t,a){"use strict";a.d(t,{A:function(){return _}});var o=a(9274),r=a(65359),s=a(35664),l=a(52946),n=a(76978),i=a(84409),c=a(56505),u=a(78920),d=a(43874),p=a(4364);const h={key:1},m={class:"content"},f={key:0,class:"banner__title"},v={class:"banner__short-description"};var y=(0,o.defineComponent)({__name:"Config",props:{mode:{},value:{}},emits:["updateYamlValues"],setup(e,{emit:t}){const a=e,y=t,b=(0,r.Pj)(),g=b.getters["i18n/t"],_=(0,o.ref)(null),k=(0,o.ref)(null),w=(0,o.ref)(""),C=(0,o.ref)(""),V=(0,o.ref)(null),A=(0,o.ref)(!0),E=(0,o.ref)(!1),P=b.getters["management/byId"](s.Mc.SETTING,"system-default-registry");async function B(e,t,a){if(!e&&(!t||!a))return void p.warn("No chart details found in annotations");let r=null,s=null;if(e&&(r=(0,o.toRaw)(b.getters["catalog/chart"]({key:e}))),r)s=r?.versions?.find((e=>e.version===a));else{const e=b.getters["catalog/charts"];r=e.find((e=>"kubewarden-policy"===e.chartType&&e.chartName===t)),s=r?.versions?.find((e=>e.version===a))}if(s)try{const e=await b.dispatch("catalog/getVersionInfo",{repoType:s.repoType,repoName:s.repoName,chartName:t,versionName:s.version});R((0,o.toRaw)(e))}catch(l){p.warn("Failed to load chart version:",l),E.value=!0}}async function x(){const e=a.value.spec?.module;if(!e)return;const[t,r]=e.split(":"),s=b.getters["catalog/charts"].filter((e=>"kubewarden-policy"===e.chartType));let l=null,n=null;e:for(const a of s)if(a?.versions?.length)for(const e of a.versions){const o=e.annotations||{},s=o[c.au.REGISTRY]||P?.value,i=o[c.au.REPOSITORY],u=o[c.au.TAG],d=`${s}/${i}`;if(d===t&&u===r){l=a,n=e;break e}}if(l&&n)try{const e=await b.dispatch("catalog/getVersionInfo",{repoType:n.repoType,repoName:n.repoName,chartName:l.chartName,versionName:n.version});R((0,o.toRaw)(e))}catch(i){p.warn("Failed to fetch version info:",i),E.value=!0}}function R(e){_.value=e,C.value=e?.chart?.description||"",V.value=e?.readme,e.questions&&(0,n.hZ)(k.value,"questions",e.questions)}const N=(0,o.ref)(null);function O(){N.value?.show()}return(0,o.onBeforeMount)((async()=>{const e=b.getters["catalog/repos"]?.length>0;!e&&b.getters["cluster/canList"](s.W8.CLUSTER_REPO)&&await b.dispatch("cluster/findAll",{type:s.W8.CLUSTER_REPO});const t=b.getters["catalog/charts"]?.length>0;t||await b.dispatch("catalog/refresh")})),(0,o.onMounted)((async()=>{k.value={policy:a.value,questions:null};const e=a.value?.metadata?.annotations?.[c.cT.CHART_KEY],t=a.value?.metadata?.annotations?.[c.cT.CHART_NAME],o=a.value?.metadata?.annotations?.[c.cT.CHART_VERSION];e||t&&o?await B(e,t,o):await x(),w.value=(0,l.Kq)(a.value),A.value=!1})),(e,t)=>A.value?((0,o.openBlock)(),(0,o.createBlock)(i.A,{key:0})):((0,o.openBlock)(),(0,o.createElementBlock)("div",h,[(0,o.createElementVNode)("div",m,[C.value?((0,o.openBlock)(),(0,o.createElementBlock)("div",f,[(0,o.createElementVNode)("p",v,(0,o.toDisplayString)(C.value),1),V.value?((0,o.openBlock)(),(0,o.createElementBlock)("button",{key:0,class:"btn btn-sm role-link banner__readme-button",onClick:O},(0,o.toDisplayString)((0,o.unref)(g)("kubewarden.policyConfig.description.showReadme")),1)):(0,o.createCommentVNode)("",!0)])):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(d.A,{value:a.value,"chart-values":k.value,"yaml-values":w.value,mode:a.mode,"error-fetching-policy":E.value,onUpdateYamlValues:t[0]||(t[0]=e=>y("updateYamlValues",e))},null,8,["value","chart-values","yaml-values","mode","error-fetching-policy"])]),V.value?((0,o.openBlock)(),(0,o.createBlock)(u.A,{key:0,ref_key:"readmePanel",ref:N,"policy-chart-details":_.value},null,8,["policy-chart-details"])):(0,o.createCommentVNode)("",!0)]))}}),b=(a(6685),a(47433));const g=(0,b.A)(y,[["__scopeId","data-v-4f77d707"]]);var _=g}}]);
//# sourceMappingURL=kubewarden-4.0.2.umd.min.edit.js.map